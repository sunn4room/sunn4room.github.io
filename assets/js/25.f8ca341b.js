(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{638:function(t,a,s){t.exports=s.p+"assets/img/kube-arch.c57273e2.svg"},694:function(t,a,s){"use strict";s.r(a);var n=s(52),e=Object(n.a)({},(function(){var t=this,a=t.$createElement,n=t._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("p",[t._v("Kubernetes 是时下最流行的开源的集群容器编排工具。")]),t._v(" "),n("ul",[n("li",[t._v("Kubernetes 起源于google 旗下 borg 系统，是其 go 语言的重构版本")]),t._v(" "),n("li",[t._v("由 go 语言开发，系统资源消耗少")]),t._v(" "),n("li",[t._v("支持集群的弹性伸缩")]),t._v(" "),n("li",[t._v("支持容器组的负载均衡")])]),t._v(" "),n("h2",{attrs:{id:"组件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#组件"}},[t._v("#")]),t._v(" 组件")]),t._v(" "),n("p",[n("img",{attrs:{src:s(638),alt:""}})]),t._v(" "),n("ul",[n("li",[n("p",[n("strong",[t._v("api server")]),t._v("：负责协调各个组件。以 Pod 的方式运行在 master 节点上，可以多实例运行。")])]),t._v(" "),n("li",[n("p",[n("strong",[t._v("etcd")]),t._v("：负责以 k-v 的形式分布式存储 kubernetes 集群资源对象的状态信息。")]),t._v(" "),n("p",[t._v("键规范为 "),n("code",[t._v("/registry/<resource-type>s/<ns-name>/...")])])]),t._v(" "),n("li",[n("p",[n("strong",[t._v("scheduler")]),t._v("：负责调度 Pod 到合适的工作节点上。以 Pod 的方式运行在 master 节点上，可以多实例运行，但一个 Pod 只能由一个 scheduler 负责。")])]),t._v(" "),n("li",[n("p",[n("strong",[t._v("controller manager")]),t._v("：负责管理各种资源的 controller 子进程，而 controller 则负责使资源状态朝着定义的期望状态收敛。以 Pod 的心事运行在 master 节点上，可以多实例运行，同一时间只有一个实例有效，其他实例备用。")])]),t._v(" "),n("li",[n("p",[n("strong",[t._v("kubelet")]),t._v("：负责所有分配过来的任务的执行，比如添加或删除 Pod 等。")])]),t._v(" "),n("li",[n("p",[n("strong",[t._v("proxy")]),t._v("：负责代理 kubernetes 集群内部或者外部对 Pod 的访问。以 Pod 的方式运行在工作节点。")])]),t._v(" "),n("li",[n("p",[n("strong",[t._v("container runtime")]),t._v("：一个编程接口，负责容器相关的工作。")])]),t._v(" "),n("li",[n("p",[t._v("*"),n("strong",[t._v("container network")]),t._v("：负责跨节点的 Pod 通信")])]),t._v(" "),n("li",[n("p",[t._v("*"),n("strong",[t._v("dns")]),t._v("：负责支持 Pod 之间以域名解析的方式通信")])]),t._v(" "),n("li",[n("p",[t._v("*"),n("strong",[t._v("ingress")]),t._v("：负责将外部的访问请求路由到合适的 Pod 中")])]),t._v(" "),n("li",[n("p",[t._v("*"),n("strong",[t._v("heapster")]),t._v("：负责监控工作节点的负载")])]),t._v(" "),n("li",[n("p",[t._v("*"),n("strong",[t._v("dashboard")]),t._v("：以可视化的方式管理 kubernetes 集群")])])]),t._v(" "),n("h2",{attrs:{id:"集群搭建与使用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#集群搭建与使用"}},[t._v("#")]),t._v(" 集群搭建与使用")]),t._v(" "),n("p",[t._v("最佳实践：")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("配置内核参数")]),t._v(" "),n("div",{staticClass:"language-properties extra-class"},[n("pre",{pre:!0,attrs:{class:"language-properties"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# /etc/sysctl.d/k8s.conf")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("net.bridge.bridge-nf-call-ip6tables")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("1")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("net.bridge.bridge-nf-call-iptables")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("1")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("net.ipv4.ip_nonlocal_bind")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("1")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("net.ipv4.ip_forward")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("1")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("vm.swappiness")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("0")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# sysctl --system")]),t._v("\n")])])])]),t._v(" "),n("li",[n("p",[t._v("关闭交换空间")]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" swapoff -a\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 也可以修改fstab永久关闭")]),t._v("\n")])])])]),t._v(" "),n("li",[n("p",[t._v("关闭防火墙")]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[t._v("ufw disable\n")])])])]),t._v(" "),n("li",[n("p",[t._v("时间同步")]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# sudo apt-get install ntpdate")]),t._v("\nntpdate cn.pool.ntp.org\n")])])])])]),t._v(" "),n("h3",{attrs:{id:"minikube"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#minikube"}},[t._v("#")]),t._v(" minikube")]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 开启 minikube")]),t._v("\nminikube start --driver"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("none/docker/virtualbox "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    --image-repository"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'registry.aliyuncs.com/google_containers'")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 停止 minikube")]),t._v("\nminikube stop\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 停止 minikube 并删除相关配置")]),t._v("\nminikube delete\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 调用内部的 kubectl")]),t._v("\nminikube kubectl -- xxx\n")])])]),n("h3",{attrs:{id:"kubeadm"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#kubeadm"}},[t._v("#")]),t._v(" kubeadm")]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# master")]),t._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" systemctl "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("enable")]),t._v(" kubelet\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("EOF"),n("span",{pre:!0,attrs:{class:"token bash punctuation"}},[t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("tee")]),t._v(" /etc/sysctl.d/k8s.conf")]),t._v("\nnet.bridge.bridge-nf-call-ip6tables = 1\nnet.bridge.bridge-nf-call-iptables = 1\nEOF")]),t._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" sysctl --system\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" kubeadm init "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--apiserver-advertise-address"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".137.151 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--image-repository"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("registry.aliyuncs.com/google_containers "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--service-cidr"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.10")]),t._v(".0.0/16 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--pod-network-cidr"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".0.0/16\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" -p "),n("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("$HOME")]),t._v("/.kube\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" -i /etc/kubernetes/admin.conf "),n("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("$HOME")]),t._v("/.kube/config\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("chown")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("id")]),t._v(" -u"),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("id")]),t._v(" -g"),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("$HOME")]),t._v("/.kube/config\n$ kubectl edit cm kube-proxy -n kube-system\n$ kubectl apply -f https://docs.projectcalico.org/manifests/calico.yaml\n")])])]),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# slave")]),t._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" kubeadm "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("join")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".137.151:6443 --token xxx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(". "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    --discovery-token-ca-cert-hash sha256:xxx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n")])])]),n("h3",{attrs:{id:"高可用集群"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#高可用集群"}},[t._v("#")]),t._v(" 高可用集群")]),t._v(" "),n("p",[t._v("k8s 集群内的组件中，除了 api server 外，都实现了高可用的功能，而 api server 可以同时存在多个，并同时向外提供 rest 服务")]),t._v(" "),n("ul",[n("li",[t._v("需要 HAproxy 解决 api server 的高可用式的负载访问问题")]),t._v(" "),n("li",[t._v("需要 Keepalived 解决 HAproxy 的单点故障问题。")])]),t._v(" "),n("h4",{attrs:{id:"keepalived"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#keepalived"}},[t._v("#")]),t._v(" Keepalived")]),t._v(" "),n("h4",{attrs:{id:"haproxy"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#haproxy"}},[t._v("#")]),t._v(" HAproxy")]),t._v(" "),n("h3",{attrs:{id:"kubectl"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#kubectl"}},[t._v("#")]),t._v(" kubectl")]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[t._v("kubectl explain xxx.xxx.xxx "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看yaml可能的字段")]),t._v("\nkubectl create namespace "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("space-name"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\nkubectl create -f "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("yaml-file"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" -n "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("space-name"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\nkubectl get "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("resource-type"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("s\nkubectl get "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("resource-type"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" -l "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("label-desc"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\nkubectl delete "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("reesource-type"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("resource-name"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\nkubectl delete "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("reesource-type"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" -l "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("label-desc"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\nkubectl logs "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("pod-name"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" -c "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("container-name"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\nkubectl port-forward "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("pod-name"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("port"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(":"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("pod-port"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 本地端口转发至pod")]),t._v("\nkubectl label "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("resource-type"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("resource-name"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("label-key"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("label-value"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\nkubectl describe "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("resource-type"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("resource-name"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\nkubectl edit "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("resource-type"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("resource-name"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 简单运行一个单容器的pod")]),t._v("\n$ kubectl run nginx --image"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("nginx\n$ kubectl run nginx --image"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("nginx --port"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("5701")]),t._v("\n$ kubectl run nginx --image"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("nginx --env"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"xxx=xxx"')]),t._v("\n$ kubectl run nginx --image"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("nginx --labels"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"xxx=xxx,xxx=xxx"')]),t._v("\n$ kubectl run nginx --image"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("nginx -- xxx xxx\n$ kubectl run nginx --image"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("nginx --command -- xxx xxx xxx\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 从 yaml 文件中创建资源")]),t._v("\n$ kubectl create -f xxx.yaml\n$ kubectl create -f xxx.yaml --namespace xxx\n$ kubectl create po/rc/rs/deployment xxx -o yaml --dry-run "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" xxx.yaml "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 生成yaml")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 资源标签")]),t._v("\n$ kubectl label po/rs/deployment xxx "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("xxx")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("xxx\n$ kubectl label po/rs/deployment xxx "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("xxx")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("xxx --overwrite\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 资源注解")]),t._v("\n$ kubectl annotate po/rs/deployment xxx "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("xxx")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("xxx\n$ kubectl annotate po/rs/deployment xxx "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("xxx")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("xxx --overwrite\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 导出服务")]),t._v("\n$ kubectl expose pod/rc/rs/deployment xxx --port"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("xx --target-port"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("xx --name"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("xxx\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 端口转发")]),t._v("\n$ kubectl port-forard xxx xx:xx\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 回滚")]),t._v("\n$ kubectl rollout status deployment/xxx\n$ kubectl rollout "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("history")]),t._v(" deployment/xxx\n$ kubectl rollout undo deployment/xxx\n$ kubectl rollout undu deployment/xxx --to-revision"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("xx\n$ kubectl rollout pause deployment/xxx\n$ kubectl rollout resume deployment/xxx\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 删除资源")]),t._v("\n$ kubectl delete pod/rs/deployment xxx\n$ kubectl delete pod/rs/deployment --selector "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'xxx,xxx'")]),t._v("\n$ kubectl delete pod/rs/deployment --namespace xxx\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看资源列表")]),t._v("\n$ kubectl get po/rs/deployment\n$ kubectl get po/rs/deployment --selector "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'xxx,xxx'")]),t._v("\n$ kubectl get po/rs/deployment --namespace xxx\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看资源详情")]),t._v("\n$ kubectl describe pod/rc/rs/deployment xxx\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 容器日志")]),t._v("\n$ kubectl logs xxx --container xxx\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# yaml api 查询")]),t._v("\n$ kubectl explain pod/rc/rs/deployment.xxx.xxx\n")])])]),n("h2",{attrs:{id:"资源"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#资源"}},[t._v("#")]),t._v(" 资源")]),t._v(" "),n("h3",{attrs:{id:"资源标签"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#资源标签"}},[t._v("#")]),t._v(" 资源标签")]),t._v(" "),n("p",[t._v("k8s 通过资源标签来进行相关的管理工作")]),t._v(" "),n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 资源标签")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("xxx")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" xxx\n")])])]),n("h4",{attrs:{id:"标签选择器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#标签选择器"}},[t._v("#")]),t._v(" 标签选择器")]),t._v(" "),n("h5",{attrs:{id:"字符串表示"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#字符串表示"}},[t._v("#")]),t._v(" 字符串表示")]),t._v(" "),n("ul",[n("li",[n("code",[t._v("label_key")]),t._v(" 包含")]),t._v(" "),n("li",[n("code",[t._v("'!label_key'")]),t._v(" 不包含")]),t._v(" "),n("li",[n("code",[t._v("label_key=label_value")])]),t._v(" "),n("li",[n("code",[t._v("label_key!=label-value")])]),t._v(" "),n("li",[n("code",[t._v("label in (xxx,xxx)")])]),t._v(" "),n("li",[n("code",[t._v("label notin (xxx,xxx)")])])]),t._v(" "),n("blockquote",[n("p",[t._v("多个元素用逗号隔开")])]),t._v(" "),n("h5",{attrs:{id:"yaml-表示"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#yaml-表示"}},[t._v("#")]),t._v(" yaml 表示")]),t._v(" "),n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("selector")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("matchLabels")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("<label-key>")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" <label"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("value"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("matchExpressions")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("key")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" <label"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("operator")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" In/NotIn/Exist/NotExist\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("values")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" <label"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("value"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n")])])]),n("h3",{attrs:{id:"资源注解"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#资源注解"}},[t._v("#")]),t._v(" 资源注解")]),t._v(" "),n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("annotations")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("xxx")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" xxx\n")])])]),n("h3",{attrs:{id:"node"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#node"}},[t._v("#")]),t._v(" Node")]),t._v(" "),n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[t._v("kubectl label node <node"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v(" <label"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("=<label"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("value"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n\nkubectl taint node <node"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v(" <taint"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("=<taint"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("value"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("<taint"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("type"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\nkubectl taint node <node"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v(" <taint"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("=<taint"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("value"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("<taint"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("type"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 删除")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# taint-type:")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   NoSchedule 不调度")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   PreferNoSchedule 尽量不调度")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   NoExecute 不调度，且正在运行的pod也会受影响")]),t._v("\n")])])]),n("h3",{attrs:{id:"namespace"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#namespace"}},[t._v("#")]),t._v(" Namespace")]),t._v(" "),n("p",[t._v("一种特殊的 kubernetes 对象，用于管理其他对象资源。")]),t._v(" "),n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Namespace\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" xxx\n")])])]),n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 使用")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespace")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" xxx\n")])])]),n("h3",{attrs:{id:"configmap"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#configmap"}},[t._v("#")]),t._v(" ConfigMap")]),t._v(" "),n("p",[t._v("存储键值对，可以被其他对象资源引用，并且达到热更新的效果。")]),t._v(" "),n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ConfigMap\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" <cm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("data")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("<key>")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" <value"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("...")]),t._v("\n")])])]),n("h3",{attrs:{id:"secret"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#secret"}},[t._v("#")]),t._v(" Secret")]),t._v(" "),n("p",[t._v("对值内容进行编解码处理。")]),t._v(" "),n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Secret\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" <cm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("stringData")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("<key>")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" <value"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("...")]),t._v("\n")])])]),n("h3",{attrs:{id:"persistentvolume"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#persistentvolume"}},[t._v("#")]),t._v(" PersistentVolume")]),t._v(" "),n("p",[t._v("持久化卷，相比与“卷”，可以独立于 pod 的生命周期之外。卷也可以引用持久化卷")]),t._v(" "),n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" PersistentVolume\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" <pv"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("capacity")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("storage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" <size"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("accessModes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ReadWriteOnce "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 只能被单个节点挂载")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ReadOnlyMany "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 可以被多个节点挂载")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ReadWriteMany\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("persistentVolumeReclaimPolicy")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Retain/Recycle/Delete\n  \t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Retain 保留")]),t._v("\n  \t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Recycle 清理再次利用")]),t._v("\n  \t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Delete 删除")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# same as volumes")]),t._v("\n")])])]),n("h3",{attrs:{id:"persistentvolumeclaim"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#persistentvolumeclaim"}},[t._v("#")]),t._v(" PersistentVolumeClaim")]),t._v(" "),n("p",[t._v("持久化卷声明，用于绑定符合要求的持久化卷。")]),t._v(" "),n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" PersistentVolumeClaim\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" <pvc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("accessModes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ReadWriteOnce\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ReadOnlyMany\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ReadWriteMany\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resources")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n     "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("requests")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n       "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("storage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" <size"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n")])])]),n("h3",{attrs:{id:"pod"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#pod"}},[t._v("#")]),t._v(" Pod")]),t._v(" "),n("p",[t._v("pod是一组并置的容器组， 代表了Kubemetes中的基本构建单元（不允许跨节点）。")]),t._v(" "),n("blockquote",[n("p",[n("strong",[t._v("为什么选择 pod 作为构建单元，而不是直接使用容器？")])]),t._v(" "),n("p",[t._v("为了便于通过容器管理其中唯一的进程，如果进程有多个，就容易出现问题，比如终端日志混乱等，不论是 docker 还是 kubernetes 都推荐一个容器一个进程。pod 就是为了实现一个容器一个进程而提出的概念。但 pod 内的容器总应该有所关联，这些由一个隐形的容器 pause 来负责关联，即一个 pod 中的多个容器共享同一个 Linux 命名空间，但不共享文件系统。")])]),t._v(" "),n("blockquote",[n("p",[n("strong",[t._v("Pod 网络")])]),t._v(" "),n("p",[t._v("Kubemetes 集群中的所有 pod 都在同一个共享网络地址空间中，底层由额外的插件基于真实链路实现，最常用的是 flannel 和 calico。")])]),t._v(" "),n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Pod\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" xxx\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tolerations")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("key")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" <taint"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("operator")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Equal/Exist\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("value")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" <taint"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("value"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("effect")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" <taint"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("type"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tolerationSeconds")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" <seconds"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 可以容忍运行的时长")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("nodeSelector")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 根据标签选择节点，已被affinity替代")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("<node-label-key>")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" <node"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("label"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("value"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("affinity")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("nodeAffinity")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      requiredDuringScheduling"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("IgnoredDuringExecution"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("nodeSelectorTerms")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("matchExpressions")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("key")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" <label"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("opreator")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" In\n            "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("values")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" <label"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("value"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n      preferredDuringScheduling"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("IgnoredDuringExecution"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("weight")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" <preferred"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("weight"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("preference")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("matchExpressions")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("key")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" <label"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("opreator")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" In\n            "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("values")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" <label"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("value"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("serviceAccountName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" xxx\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("initContainers")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 先于containers且顺序执行，可以通过共享卷向主容器提供文件")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("...")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 初始容器需要一次性执行完毕，并即时销毁")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containers")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" xxx\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" xxx\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("imagePullPolicy")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Always/IfNotPresent/Never\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"xxx"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v('"xxx"'),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("...")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("args")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"xxx"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v('"xxx"'),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("...")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resources")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("requests")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cpu")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" <cpu"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("memory")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" <memory"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("limits")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cpu")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" <cpu"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("memory")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" <memory"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n    hostNetwork：true "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 是否直接使用宿主机的网络空间")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containerPort")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" xx\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hostPort")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" xx\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("env")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" <env"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("value")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" <env"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("value"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" <env"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("valueFrom")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("configMapKeyRef")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 从configmap中读取值")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" <configmap"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("key")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" <configmap"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("secretKeyRef")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" <secret"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("key")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" <secret"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("fieldRef")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("fieldPath")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" <元数据路径"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# metadata.name")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# metadata.namespace")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# status.podIP")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# spec.nodeName")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# spec.serviceAccountName")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resourceFieldRef")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resource")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" <资源路径"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# requests.cpu")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# requests.memory")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# limits.cpu")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# limits.memory")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("divisor")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" <divisor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("envFrom")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("prefix")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" <prefix"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 可省略")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ConfigMapRef")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" <configmap"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("prefix")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("SecretRef")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" <secret"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumeMounts")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" <volume"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mountPath")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" <mount"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("livenessProbe")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 存活探针")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("httpGet")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 可访问且返回值是2xx 3xx 表示存活")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("path")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /xxx/xxx\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" xx\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("exec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 返回值是0表示存活")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"xxx"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"xxx"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v('"xxx"'),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("...")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tcpSocket")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# tcp连接成功表示存好")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" <port"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("readinessProbe")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      <同livenessProbe"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" <volume"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("emptyDir")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 空白卷，用作pod中多容器的共享文件夹")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" <volume"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hostPath")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 节点卷")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("path")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" <path or file"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Directory/File\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" <volume"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("gitRepo")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# git 仓库")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("repository")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" <git"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("address"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("revision")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" <git"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("brach"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("directory")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" <positioin"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" <volume"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("configMap")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 以文件的形式存储键值对，支持热更新")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" <configmap"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" <volume"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("secret")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 以文件的形式通过编解码存储键值对，支持热更新")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" <secret"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" <volume"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("downwardAPI")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 以文件的形式存储pod元数据，支持热更新")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("items")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("path")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" <volume"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("fieldRef")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("fieldPath")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" <元数据路径"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# metadata.labels")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# metadata.annotations")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 同spec.containers.env.valueFrom.fieldRef.fieldPath")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("path")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" <volume"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resourceFieldRef")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resource")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" <资源路径"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 同spec.containers.env.valueFrom.resourceFieldRef.resource")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containerName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" <container"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("divisor")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" <divisor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" <volume"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("nfs")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("path")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" <nfs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("server")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" <nfs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("server"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("dist"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" <volume"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("persistentVolumeClaim")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("claimName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" <pvc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dnsPolicy")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Default/ClusterFirst/ClusterFirstWithHostNet\n")])])]),n("h3",{attrs:{id:"replicationcontroller"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#replicationcontroller"}},[t._v("#")]),t._v(" ReplicationController")]),t._v(" "),n("p",[t._v("针对无状态 Pod 可以使用 ReplicationController  来管理，当根据选择器得到的 Pod 数量 少了或多了会自动进行调整。")]),t._v(" "),n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ReplicationController\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" xxx\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("replicas")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" xx\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("selector")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 建议不配置，将自动提取template中的标签信息")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("xxx")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" xxx\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("template")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 当需要pod时以此为模板创建")]),t._v("\n    <pod"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("template"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n")])])]),n("h3",{attrs:{id:"replicaset"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#replicaset"}},[t._v("#")]),t._v(" ReplicaSet")]),t._v(" "),n("p",[t._v("升级版的 ReplicationController ，主要升级了标签选择机制。")]),t._v(" "),n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" apps/v1beta2\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ReplicaSet\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" xxx\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("replicas")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" <replicas"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("num"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("selector")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("matchLabels")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("<label-key>")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" <label"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("value"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("matchExpressions")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("key")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" <label"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("operator")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" In/NotIn/Exist/NotExist\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("values")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" <label"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("value"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("template")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 当需要pod时以此为模板创建")]),t._v("\n    <pod"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("template"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n")])])]),n("h3",{attrs:{id:"deployment"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#deployment"}},[t._v("#")]),t._v(" Deployment")]),t._v(" "),n("p",[t._v("不论是 ReplicationController 还是 ReplicaSet 都是通过标签来完成副本操作的，而镜像版本信息并没有绑定到标签信息中，升级时需要修改模板中的版本并手动删除所有的 Pod。 为了协调 Pod 版本升级过程，在 ReplicaSet 之上定义的一个新资源，这样，ReplicaSet 管理 Pod ，而 Deployment 管理 ReplicaSet。升级时会创建一个新的 ReplicaSet，并逐步完成 Pod 的新旧更替到新的 ReplicaSet。触发条件也不仅仅是简单的选择器，还有模板信息的变更也会触发升级（而 RC/RS 不会触发）")]),t._v(" "),n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" apps/v1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Deployment\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" xxx\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("replicas")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" xx\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("selector")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# same as ReplicaSet")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("strategy")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" RollingUpdate\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("rollingUpdate")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("maxSurge")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 数量增加上限")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("maxUnavailable")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 数量减少上限")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("template")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# pod-template")]),t._v("\n")])])]),n("h3",{attrs:{id:"statefulset"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#statefulset"}},[t._v("#")]),t._v(" StatefulSet")]),t._v(" "),n("p",[t._v("针对有状态 Pod ，是 Deployment 的扩展，增添了对 PVC 的管理，引入了“PVC模板”的概念。会自动创建名称为"),n("code",[t._v("pvc-ss-num")]),t._v("的pvc，当pod消失时，pvc还在，重新创建的pod还是会绑定到先前序号的pvc上。")]),t._v(" "),n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 无头服务，没有集群ip，直接对接 pod ip，而不是一组pod ip列表")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Service\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" headless"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("svc\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" xx\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" xxx\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("clusterIP")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" None\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("selector")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("xxx")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" xxx\n")])])]),n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" apps/v1beta1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" StatefulSet\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" xxx\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("serviceName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" headless"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("svc\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("replicas")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" xx\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("selector")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("matchLabels")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("xxx")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" xxx\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("template")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    <pod"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("template"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumeClaimTemplates")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" pvc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("template\n")])])]),n("h3",{attrs:{id:"daemonset"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#daemonset"}},[t._v("#")]),t._v(" DaemonSet")]),t._v(" "),n("p",[t._v("保证部署到每个节点。")]),t._v(" "),n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" apps/v1beta2\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" DaemonSet\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" xxx\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("selector")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# same as ReplicaSet")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("template")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# pod-template")]),t._v("\n")])])]),n("h3",{attrs:{id:"job"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#job"}},[t._v("#")]),t._v(" Job")]),t._v(" "),n("p",[t._v("执行完成后不重建新 Pod，但是当节点故障时，它上面的 Job 管理的 Pod 会重建。")]),t._v(" "),n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" batch/v1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Job\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" xxx\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("completions")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" xx "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 执行数")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("parallelism")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" xx "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 最大并发数")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("template")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# pod template")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# spec.restartPolicy: OnFailure")]),t._v("\n")])])]),n("h3",{attrs:{id:"cronjob"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#cronjob"}},[t._v("#")]),t._v(" CronJob")]),t._v(" "),n("p",[t._v("定时的 Job。")]),t._v(" "),n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" batch/v1beta1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" CronJob\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" <cronjob"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("schedule")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"<minute> <hour> <day-in-mouth> <mouth> <week>"')]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("completions")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" xx "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 执行数")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("parallelism")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" xx "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 最大并发数")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("jobTemplate")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# job template")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# spec.template.spec.restartPolicy: OnFailure")]),t._v("\n")])])]),n("h3",{attrs:{id:"service"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#service"}},[t._v("#")]),t._v(" Service")]),t._v(" "),n("p",[t._v("为一组功能相同的 Pod 提供单一不变的接入点。")]),t._v(" "),n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Service\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" <sv"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ClusterIP/NodePort/LoadBalancer/ExternalName\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ClusterIP 只暴露一个只能集群内部访问的IP")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# NodePort ClusterIP的基础上，在每个集群节点上暴露一个可以被外部访问的端口")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# LoadBalance NodePort的基础上，进行负载均衡")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ExternalName 将外部服务接入到集群中来")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("sessionAffinity")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" None/ClientIP\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("clusterIP")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" None "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 用于定义无头服务，dns服务将直接返回该服务管理的pod的ip列表")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" xx\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("targetPort")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" xx\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("selector")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# same as ReplicaSet")]),t._v("\n")])])]),n("h3",{attrs:{id:"ingress"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ingress"}},[t._v("#")]),t._v(" Ingress")]),t._v(" "),n("p",[t._v("由 Ingress 组件（nginx-ingress-controller）接收外界的流量，由 Ingress 资源配置流量的流向。Service 支持 4 层分流，即端口级别的反流，而 Ingress 则提供的 7 层分流，即 http/https 等级别的分流。")]),t._v(" "),n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" extensions/v1beta1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Ingress\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" <ingress"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("rules")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" <host"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("str"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("http/https")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("paths")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("path")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" <path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("backend")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("serviceName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" <svc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("servecePort")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" <svc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("port"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n")])])]),n("h2",{attrs:{id:"安全控制"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#安全控制"}},[t._v("#")]),t._v(" 安全控制")]),t._v(" "),n("h3",{attrs:{id:"认证与-rbac-授权"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#认证与-rbac-授权"}},[t._v("#")]),t._v(" 认证与 RBAC 授权")]),t._v(" "),n("h4",{attrs:{id:"user-和-user-s-group"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#user-和-user-s-group"}},[t._v("#")]),t._v(" User 和 User's Group")]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 生成用户私钥")]),t._v("\nopenssl genrsa -out "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("user"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(".key "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2048")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 生成证书请求")]),t._v("\nopenssl req -new -key "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("user"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(".key -out "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("user"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(".csr -subj "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/CN=<user>/O=<user-group>"')]),t._v("\n---\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 生成用户证书")]),t._v("\nopenssl x509 -req -in "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("user"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(".csr -CA ca.crt -CAkey ca.key -CAcreateserial "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    -out "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("user"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(".crt -days "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("30")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 生成用户对应的 kubeconfig")]),t._v("\nkubectl config set-cluster kubernetes "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    --certificate-authority"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("ca.crt "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    --server"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("kube-server"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    --embed-certs"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("true "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    --kubeconfig"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("user"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(".kubeconfig\nkubectl config set-credentials "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("user"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    --client-certificate"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("user"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(".crt "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    --client-key"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("user"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(".key\n    --kubeconfig"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("user"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(".kubeconfig\nkubectl config set-context kubernetes "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    --cluster"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("kubernetes "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    --namespace"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("user"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    --user"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("user"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    --kubeconfig"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("user"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(".kubeconfig\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 设置默认上下文")]),t._v("\nkubectl config use-context kubernetes --kubeconfig"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("user"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(".kubeconfig\n")])])]),n("h4",{attrs:{id:"serviceaccount"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#serviceaccount"}},[t._v("#")]),t._v(" ServiceAccount")]),t._v(" "),n("p",[t._v("代表一个账户标识，pod 在创建时会绑定一个 ServiceAccount，每个命名空间下都有一个默认的 ServiceAccount")]),t._v(" "),n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ServiceAccount\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" xxx\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespace")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" xxx\n")])])]),n("h4",{attrs:{id:"role-与-rolebinding"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#role-与-rolebinding"}},[t._v("#")]),t._v(" Role 与 RoleBinding")]),t._v(" "),n("p",[t._v("Role 代表的经典的 RBAC 中的角色，就是定义的权限范围，而 RoleBinding 用于将 Role 和指定的 ServiceAccount 进行绑定，赋予 ServiceAccount 特定的权限。")]),t._v(" "),n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" rbac.authorization.k8s.io/v1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Role\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" <role"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespace")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" <role"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("ns"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("rules")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiGroups")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"xxx"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 资源所属组")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resources")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"<resource>s"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("verbs")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"get/list..."')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" rbac.authorization.k8s.io/v1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" RoleBinding\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" xxx\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespace")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" xxx\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("roleRef")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiGroup")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" rbac.authorization.k8s.io\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Role\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" xxx\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("subjects")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 绑定多个 ServiceAccount/User/Group")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ServiceAccount\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" xxx\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" User\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" xxx\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Group\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" xxx\n")])])]),n("h4",{attrs:{id:"clusterrole-与-clusterrolebinding"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#clusterrole-与-clusterrolebinding"}},[t._v("#")]),t._v(" ClusterRole 与 ClusterRoleBinding")]),t._v(" "),n("p",[t._v("不同的是 cluster role 没有命名空间的限制，并且可以得到集群级别的资源对象的控制，比如 PV")]),t._v(" "),n("h3",{attrs:{id:"networkpolicy"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#networkpolicy"}},[t._v("#")]),t._v(" NetworkPolicy")]),t._v(" "),n("p",[t._v("控制 Pod 之间的通信")]),t._v(" "),n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" networking.k8s.io/v1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" NetworkPolicy\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" <np"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespace")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" <ns"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("podSelector")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    <select pod"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ingress")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 控制入度")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("from")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("podSelctor")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        <select pod"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" <port"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("egress")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("to")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("podSelctor")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        <select pod"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" <port"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n")])])]),n("h2",{attrs:{id:"扩展"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#扩展"}},[t._v("#")]),t._v(" 扩展")]),t._v(" "),n("h3",{attrs:{id:"customresourcedefinition"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#customresourcedefinition"}},[t._v("#")]),t._v(" CustomResourceDefinition")]),t._v(" "),n("h4",{attrs:{id:"自定义控制器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#自定义控制器"}},[t._v("#")]),t._v(" 自定义控制器")]),t._v(" "),n("h4",{attrs:{id:"自定义-api-server"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#自定义-api-server"}},[t._v("#")]),t._v(" 自定义 Api Server")]),t._v(" "),n("h3",{attrs:{id:"kubebuilder"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#kubebuilder"}},[t._v("#")]),t._v(" kubebuilder")]),t._v(" "),n("h4",{attrs:{id:"初始化"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#初始化"}},[t._v("#")]),t._v(" 初始化")]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[t._v("$ kubebuilder init --domain xxx.xxx --repo xxx\n")])])]),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v(".\n├── bin/\n├── config/\n│   ├── certmanager/\n│   ├── default/\n│   ├── manager/\n│   ├── prometheus/\n│   ├── rbac/\n│   └── webhook/\n├── hack/\n├── Dockerfile\n├── .gitignore\n├── go.mod\n├── go.sum\n├── main.go\n├── Makefile\n└── PROJECT\n")])])]),n("h4",{attrs:{id:"创建-api-和-controller"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#创建-api-和-controller"}},[t._v("#")]),t._v(" 创建 API 和 Controller")]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[t._v("$ kubebuilder create api --group xxx --version xx --kind Xxx\n")])])]),n("blockquote",[n("p",[t._v("资源的组是 domain + group")])]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v(".\n├── api/\n│   └── <version>\n│       ├── <kind>_types.go\n│       ├── groupversion_info.go [元数据信息]\n│       └── zz_generated.deepcopy.go [实现了 runtime.Object]\n└── controllers/\n")])])]),n("h4",{attrs:{id:"编辑-api"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#编辑-api"}},[t._v("#")]),t._v(" 编辑 API")]),t._v(" "),n("p",[t._v("在 api 文件夹下编辑 "),n("code",[t._v("<version>/<kind>_types.go")])]),t._v(" "),n("div",{staticClass:"language-go extra-class"},[n("pre",{pre:!0,attrs:{class:"language-go"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 注意: json 标签是必需的")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// XxxSpec 定义了 CronJob 期待的状态")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(" XxxSpec "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// +kubebuilder:validation:")]),t._v("\n    Xxx Xxx "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`json:"xxx"`')]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// +optional")]),t._v("\n    Xxx Xxx "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`json:"xxx,omitempty"`')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// XxxStatus 定义了 CronJob 观察的的状态")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(" XxxStatus "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tXxx Xxx "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`json:"xxx"`')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// +kubebuilder:object:root=true")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// +kubebuilder:subresource:status")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(" Xxx "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    metav1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("TypeMeta   "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`json:",inline"`')]),t._v("\n    metav1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ObjectMeta "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`json:"metadata,omitempty"`')]),t._v("\n\n    Spec   XxxSpec   "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`json:"spec,omitempty"`')]),t._v("\n    Status XxxStatus "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`json:"status,omitempty"`')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// +kubebuilder:object:root=true")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(" XxxList "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    metav1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("TypeMeta "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`json:",inline"`')]),t._v("\n    metav1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ListMeta "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`json:"metadata,omitempty"`')]),t._v("\n    Items           "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("Xxx "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`json:"items"`')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[t._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v(" generate\n")])])]),n("h4",{attrs:{id:"编辑-controller"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#编辑-controller"}},[t._v("#")]),t._v(" 编辑 Controller")]),t._v(" "),n("div",{staticClass:"language-go extra-class"},[n("pre",{pre:!0,attrs:{class:"language-go"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// +kubebuilder:rbac:groups=xxx,resources=xxxs,verbs=xxx;xxx")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("r "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("XxxReconciler"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Reconcile")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("req ctrl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctrl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Result"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("error")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n    \n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// return ctrl.Result{}, nil")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// return ctrl.Result{}, err")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// return ctrl.Result{Requeue: true}, nil")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// return ctrl.Result{RequeueAfter: time.Second*5}, nil")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("r "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("XxxReconciler"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("SetupWithManager")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mgr ctrl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Manager"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("error")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" ctrl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("NewControllerManagedBy")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mgr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("For")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("xxx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Xxx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n    \t"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Owns")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("xxx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Xxx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Watches")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("xxx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Xxx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" xxx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Complete")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("r"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[t._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v(" manifests\n")])])]),n("h4",{attrs:{id:"运行"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#运行"}},[t._v("#")]),t._v(" 运行")]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[t._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v(" run\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v(" docker-build docker-push "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("IMG")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("some-registry"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("/"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("project-name"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(":tag\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v(" deploy "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("IMG")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("some-registry"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("/"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("project-name"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(":tag\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v(" uninstall\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v(" undeploy\n")])])]),n("h3",{attrs:{id:"service-catalog"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#service-catalog"}},[t._v("#")]),t._v(" Service Catalog")]),t._v(" "),n("h2",{attrs:{id:"helm"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#helm"}},[t._v("#")]),t._v(" Helm")]),t._v(" "),n("p",[t._v("是 kuberentes 平台的包管理器")]),t._v(" "),n("h3",{attrs:{id:"概念"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#概念"}},[t._v("#")]),t._v(" 概念")]),t._v(" "),n("ul",[n("li",[t._v("Chart： 就是一个用helm打包好的应用。 包含运行该应用的所有资源的定义或工具。")]),t._v(" "),n("li",[t._v("Repository：用于存储和分享打包好的应用")]),t._v(" "),n("li",[t._v("Release：应用在kuberentes中运行的一个实例")])]),t._v(" "),n("h3",{attrs:{id:"架构"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#架构"}},[t._v("#")]),t._v(" 架构")]),t._v(" "),n("ul",[n("li",[t._v("Helm Client： 客户端，用于helm的操作")]),t._v(" "),n("li",[t._v("Helm Library： 服务端，通kuberents api进行交互（相当于 K8S 的一个客户端）")])]),t._v(" "),n("h3",{attrs:{id:"常用命令"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#常用命令"}},[t._v("#")]),t._v(" 常用命令")]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[t._v("helm search hub "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("chart"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\nhelm repo "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("repo-name"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("repo-dist"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# helm repo add official https://kubernetes-charts.storage.googleapis.com/")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# helm repo add aliyun https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts/")]),t._v("\nhelm repo update\nhelm repo list\nhelm repo remove "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("repo-name"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\nhelm search "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("repo-name"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("chart"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\nhelm pull "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("repo-name"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("/"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("chart"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("tar")]),t._v(" -zxvf "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("chart"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("-"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("version"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(".tgz\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# chart 目录结构")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# .")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# |-- Chart.yaml <chart元数据>")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# |-- charts <关联charts>")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# |-- templates <模板目录>")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# |   |-- xxx.yaml")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# `-- values.yaml <值覆盖>")]),t._v("\nhelm show all/values "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("chart/folder"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\nhelm "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("release-name"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("chart/folder"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" -n "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("namespace"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\nhelm status all/values "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("release-name"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\nhelm upgrade "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("release-name"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("chart/folder"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" --set "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("key"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("value"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\nhelm rollback "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("release-name"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\nhelm list\nhelm uninstall "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("release-name"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" -n "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("namespace"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),n("h3",{attrs:{id:"模板"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#模板"}},[t._v("#")]),t._v(" 模板")]),t._v(" "),n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# xxx.yaml")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" .Release.Name/Namespace "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" .Values.xxx "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(' default "xxx" '),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" .Values.xxx "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" quote "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" .Values.xxx "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" indent 4 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" .Values.xxx "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" repeat 4 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" .Values.xxx "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" upper "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(' include "xxx" . '),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(' printf "%s'),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v('%s" xxx xxx '),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" toYaml xx "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" with .Values.xx "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" end "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" if xx "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" if and xx xx "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" if or xx xx "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" else if "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("...")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" else "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" end "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ranger $. xx "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("/* do something with . "),n("span",{pre:!0,attrs:{class:"token important"}},[t._v("*/")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" end "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(' (lookup "<apiVersion'),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v('" "<resource'),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v('" "<namespace'),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v('" "<name'),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v('").metadata.annotations '),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" range $index"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" $service "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v('= (lookup "v1" "Service" "mynamespace" "").items '),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("/* do something with each service "),n("span",{pre:!0,attrs:{class:"token important"}},[t._v("*/")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" end "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# _helper.tpl")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(' define "xx" '),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("...")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" end "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])}),[],!1,null,null,null);a.default=e.exports}}]);