<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Netty 学习笔记 | sunn4room</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="icon" href="/favicon.png">
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.62005803.css" as="style"><link rel="preload" href="/assets/js/app.2d05b873.js" as="script"><link rel="preload" href="/assets/js/9.fd2d7f08.js" as="script"><link rel="preload" href="/assets/js/3.5fc63a44.js" as="script"><link rel="preload" href="/assets/js/4.caf2fcbd.js" as="script"><link rel="prefetch" href="/assets/js/10.50ae4a69.js"><link rel="prefetch" href="/assets/js/11.afdccb1f.js"><link rel="prefetch" href="/assets/js/12.0010c894.js"><link rel="prefetch" href="/assets/js/13.eb55877c.js"><link rel="prefetch" href="/assets/js/14.65cfc2ff.js"><link rel="prefetch" href="/assets/js/15.0b8b74f4.js"><link rel="prefetch" href="/assets/js/16.4dbb4aa4.js"><link rel="prefetch" href="/assets/js/17.271c05bb.js"><link rel="prefetch" href="/assets/js/18.4c3e94d0.js"><link rel="prefetch" href="/assets/js/19.1a0cddca.js"><link rel="prefetch" href="/assets/js/2.d45a9055.js"><link rel="prefetch" href="/assets/js/20.cdf7cb28.js"><link rel="prefetch" href="/assets/js/21.fbf2cd3f.js"><link rel="prefetch" href="/assets/js/22.42257d5f.js"><link rel="prefetch" href="/assets/js/23.e26a383f.js"><link rel="prefetch" href="/assets/js/24.d9c833cd.js"><link rel="prefetch" href="/assets/js/25.f8ca341b.js"><link rel="prefetch" href="/assets/js/26.a42edc25.js"><link rel="prefetch" href="/assets/js/27.0127ab0c.js"><link rel="prefetch" href="/assets/js/28.cd79c0d4.js"><link rel="prefetch" href="/assets/js/29.c3f37782.js"><link rel="prefetch" href="/assets/js/30.043d284c.js"><link rel="prefetch" href="/assets/js/31.423ed3ce.js"><link rel="prefetch" href="/assets/js/32.26519eb1.js"><link rel="prefetch" href="/assets/js/33.f57167ad.js"><link rel="prefetch" href="/assets/js/34.ecaa6ee5.js"><link rel="prefetch" href="/assets/js/35.47e91ee0.js"><link rel="prefetch" href="/assets/js/36.258a624f.js"><link rel="prefetch" href="/assets/js/37.68bb6fda.js"><link rel="prefetch" href="/assets/js/38.94239711.js"><link rel="prefetch" href="/assets/js/39.e83c38cf.js"><link rel="prefetch" href="/assets/js/40.acf21eb1.js"><link rel="prefetch" href="/assets/js/41.d164530a.js"><link rel="prefetch" href="/assets/js/5.886701df.js"><link rel="prefetch" href="/assets/js/6.61d8e906.js"><link rel="prefetch" href="/assets/js/7.177acf7a.js"><link rel="prefetch" href="/assets/js/8.84396220.js">
    <link rel="stylesheet" href="/assets/css/0.styles.62005803.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="app"><div id="header"><img id="hero" src="/assets/img/hero.470debc7.png"><span id="title">Netty 学习笔记</span><div id="search-box" class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div><aside id="aside"><div class="__vuescroll" style="height:100%;width:100%;padding:0;position:relative;overflow:hidden;"><div class="__panel __hidebar" style="position:relative;box-sizing:border-box;height:100%;overflow-y:hidden;overflow-x:hidden;transform-origin:;transform:;"><div class="__view" style="position:relative;box-sizing:border-box;min-width:100%;min-height:100%;"><div class="margin-box"><div class="white-line"></div><div class="shell"><div class="sh-header"><div class="dot" style="background-color: #e9524a"></div><div class="dot" style="background-color: #f1ae1b"></div><div class="dot" style="background-color: #59c837"></div></div><div class="sh-body"><div class="line"><span>&gt; </span><span style="color:#4ebdcf">Who are you?</span></div><div class="line right"><span style="color:#97d209">I'm sunn4room</span><span> &lt;</span></div><div class="line right"><span style="color:#97d209">em... Just Sunny Room</span><span> &lt;</span></div><div class="line right"><span style="color:#97d209">And you?</span><span class="cursor">a</span><span> &lt;</span></div></div></div><div class="header-tag" style="font-size:1rem;font-weight:bold;margin-top:1.5rem;">Netty 学习笔记</div><a href="#线程模型" class="header-tag" style="font-size:1rem;margin-left:1rem;">线程模型</a><a href="#传统阻塞模型" class="header-tag" style="font-size:1rem;margin-left:2rem;">传统阻塞模型</a><a href="#reactor-模型" class="header-tag" style="font-size:1rem;margin-left:2rem;">Reactor 模型</a><a href="#单-reactor-单线程" class="header-tag" style="font-size:1rem;margin-left:3rem;">单 Reactor 单线程</a><a href="#单-reactor-多线程" class="header-tag" style="font-size:1rem;margin-left:3rem;">单 Reactor 多线程</a><a href="#主从-reactor-多线程" class="header-tag" style="font-size:1rem;margin-left:3rem;">主从 Reactor 多线程</a><a href="#netty-采用的线程模型" class="header-tag" style="font-size:1rem;margin-left:2rem;">Netty 采用的线程模型</a><a href="#netty-官方示例" class="header-tag" style="font-size:1rem;margin-left:1rem;">Netty 官方示例</a><a href="#netty-字节缓存器" class="header-tag" style="font-size:1rem;margin-left:1rem;">Netty 字节缓存器</a><a href="#bytebuf" class="header-tag" style="font-size:1rem;margin-left:2rem;">ByteBuf</a><a href="#堆模式" class="header-tag" style="font-size:1rem;margin-left:3rem;">堆模式</a><a href="#直接模式" class="header-tag" style="font-size:1rem;margin-left:3rem;">直接模式</a><a href="#聚合模式" class="header-tag" style="font-size:1rem;margin-left:3rem;">聚合模式</a><a href="#bytebufholder" class="header-tag" style="font-size:1rem;margin-left:2rem;">ByteBufHolder</a><a href="#bytebufallocator" class="header-tag" style="font-size:1rem;margin-left:2rem;">ByteBufAllocator</a><a href="#unpooled" class="header-tag" style="font-size:1rem;margin-left:2rem;">UnPooled</a><a href="#bytebufutil" class="header-tag" style="font-size:1rem;margin-left:2rem;">ByteBufUtil</a><a href="#netty-数据通道" class="header-tag" style="font-size:1rem;margin-left:1rem;">Netty 数据通道</a><a href="#channel" class="header-tag" style="font-size:1rem;margin-left:2rem;">Channel</a><a href="#channelhandler" class="header-tag" style="font-size:1rem;margin-left:2rem;">ChannelHandler</a><a href="#channelpipeline-和-channelhandlercontext" class="header-tag" style="font-size:1rem;margin-left:2rem;">ChannelPipeline 和 ChannelHandlerContext</a><a href="#异常处理" class="header-tag" style="font-size:1rem;margin-left:2rem;">异常处理</a><a href="#netty-事件执行器" class="header-tag" style="font-size:1rem;margin-left:1rem;">Netty 事件执行器</a><a href="#netty-引导器" class="header-tag" style="font-size:1rem;margin-left:1rem;">Netty 引导器</a><a href="#bootstrap" class="header-tag" style="font-size:1rem;margin-left:2rem;">Bootstrap</a><a href="#serverbootstrap" class="header-tag" style="font-size:1rem;margin-left:2rem;">ServerBootstrap</a><a href="#netty-编解码器" class="header-tag" style="font-size:1rem;margin-left:1rem;">Netty 编解码器</a><a href="#解码器" class="header-tag" style="font-size:1rem;margin-left:2rem;">解码器</a><a href="#bytetomessagedecoder" class="header-tag" style="font-size:1rem;margin-left:3rem;">ByteToMessageDecoder</a><a href="#messagetomessagedecoder-i" class="header-tag" style="font-size:1rem;margin-left:3rem;">MessageToMessageDecoder\</a><a href="#编码器" class="header-tag" style="font-size:1rem;margin-left:2rem;">编码器</a><a href="#messagetobyteencoder-i" class="header-tag" style="font-size:1rem;margin-left:3rem;">MessageToByteEncoder\</a><a href="#messagetomessageencoder-i" class="header-tag" style="font-size:1rem;margin-left:3rem;">MessageToMessageEncoder\</a><a href="#编解码器" class="header-tag" style="font-size:1rem;margin-left:2rem;">编解码器</a><a href="#bytetomessagecodec-i" class="header-tag" style="font-size:1rem;margin-left:3rem;">ByteToMessageCodec\</a><a href="#messagetomessagecodec-inbound-in-outbound-in" class="header-tag" style="font-size:1rem;margin-left:3rem;">MessageToMessageCodec\</a><a href="#channelhandler-2" class="header-tag" style="font-size:1rem;margin-left:1rem;">ChannelHandler</a><a href="#channelinboundhandler" class="header-tag" style="font-size:1rem;margin-left:2rem;">ChannelInboundHandler</a><a href="#channelinitializer" class="header-tag" style="font-size:1rem;margin-left:3rem;">ChannelInitializer</a><a href="#simplechannelinboundhandler" class="header-tag" style="font-size:1rem;margin-left:3rem;">SimpleChannelInboundHandler</a><a href="#channeloutboundhandler" class="header-tag" style="font-size:1rem;margin-left:2rem;">ChannelOutboundHandler</a><a href="#channelduplexhandler" class="header-tag" style="font-size:1rem;margin-left:2rem;">ChannelDuplexHandler</a><a href="#combinedchannelduplexhandler" class="header-tag endtag" style="font-size:1rem;margin-left:3rem;">CombinedChannelDuplexHandler</a></div></div></div></div></aside><div id="curtain"></div><main id="main"><div class="__vuescroll" style="height:100%;width:100%;padding:0;position:relative;overflow:hidden;"><div class="__panel __hidebar" style="position:relative;box-sizing:border-box;height:100%;overflow-y:hidden;overflow-x:hidden;transform-origin:;transform:;"><div class="__view" style="position:relative;box-sizing:border-box;min-width:100%;min-height:100%;"><div class="margin-box"><div class="white-line"></div><div class="box"><div class="post-tags"><span class="post-tag ca-tag"><span><a class="firstca endcd" style="color: white">网络技术</a><!----></span></span><a class="ta-tag post-tag">学习笔记</a><a class="ta-tag post-tag">java</a><a class="ta-tag post-tag">netty</a><a class="ta-tag post-tag">network</a><span class="da-tag post-tag">2020.06.18</span><span class="uda-tag post-tag">2020.06.18</span></div></div><div class="box"><h1 style="text-align:center;">Netty 学习笔记</h1><div class="markdown-body content__default"><p>Netty 是一款<strong>支持异步 API</strong> 的<strong>事件驱动</strong>的网络应用程序框架，支持快速地开发可维护的高性能的面向协议的服务器和客户端。Netty 的底层是对 Java 原生 NIO 的二次封装，功能更加强大。</p> <p>现如今，我们使用通用的应用程序或者类库来实现互相通讯，但是，有时候一个通用的协议或他的实现并没有很好的满足需求。比如我们无法使用一个通用的 HTTP 服务器来处理大文件、电子邮件以及近实时消息，比如金融信息和多人游戏数据。我们需要一个更底层的通信协议框架来简化自定义通信协议的开发。而这正是 Netty 存在的意义。</p> <p><img src="/assets/img/components.334d6816.png" alt=""></p> <ul><li>支持零拷贝的字节缓存器</li> <li>统一的异步 I/O API</li> <li>可扩展的事件处理模型</li> <li>多种协议支持</li> <li>多种传输服务支持</li></ul> <blockquote><p>Java IO 模型</p> <ul><li>BIO：同步且阻塞，小明把水壶放到火上，然后在那傻等水开</li> <li>NIO：同步非阻塞，小明把水壶放到火上，然后去客厅看电视，时不时的去厨房看看水开没有</li> <li>AIO：异步非阻塞，小明把响水水壶放到火上，去客厅看电视，响了再去处理</li></ul></blockquote> <blockquote><p>Java 原生 NIO 的缺点：</p> <ul><li>API 设计不够优秀，Selector、Channel、ByteBuffer</li> <li>对于底层操作的封装不够，需要关心太多业务之外的代码，比如多线程、重连、半包黏包、网络拥塞等</li> <li>臭名昭著的 Epoll Bug 即 Selector 空轮询</li></ul></blockquote> <h2 id="线程模型"><a href="#线程模型" class="header-anchor">#</a> 线程模型</h2> <h3 id="传统阻塞模型"><a href="#传统阻塞模型" class="header-anchor">#</a> 传统阻塞模型</h3> <img src="/assets/img/simple-mod.0d61fd56.png" style="zoom:80%;"> <h3 id="reactor-模型"><a href="#reactor-模型" class="header-anchor">#</a> Reactor 模型</h3> <h4 id="单-reactor-单线程"><a href="#单-reactor-单线程" class="header-anchor">#</a> 单 Reactor 单线程</h4> <img src="/assets/img/reactor-mod1.8452fa8d.png" style="zoom:80%;"> <h4 id="单-reactor-多线程"><a href="#单-reactor-多线程" class="header-anchor">#</a> 单 Reactor 多线程</h4> <img src="/assets/img/reactor-mod2.dc0feea3.png" style="zoom:80%;"> <h4 id="主从-reactor-多线程"><a href="#主从-reactor-多线程" class="header-anchor">#</a> 主从 Reactor 多线程</h4> <img src="/assets/img/reactor-mod3.e69f2a59.png" style="zoom:80%;"> <blockquote><p>Reactor 其实就是事件驱动的意思，当有连接请求、读请求、写请求产生时都可以唤醒对应的 Reactor ，并作出处理。</p></blockquote> <h3 id="netty-采用的线程模型"><a href="#netty-采用的线程模型" class="header-anchor">#</a> Netty 采用的线程模型</h3> <h2 id="netty-官方示例"><a href="#netty-官方示例" class="header-anchor">#</a> Netty 官方示例</h2> <h2 id="netty-字节缓存器"><a href="#netty-字节缓存器" class="header-anchor">#</a> Netty 字节缓存器</h2> <p>特性：</p> <ul><li>容量自适应</li> <li>读写无需切换</li> <li>链式调用</li> <li>引入视图概念</li> <li>支持池化技术</li></ul> <h3 id="bytebuf"><a href="#bytebuf" class="header-anchor">#</a> ByteBuf</h3> <p>由不同的索引分别控制读访问和写访问的字节数组，可以对缓冲区进行随机访问、读写、索引管理、查找、创建视图、拷贝、属性访问等。</p> <ul><li>读索引：readerIndex</li> <li>写索引：writerIndex</li></ul> <p><img src="/assets/img/image-20191217163813035.b66ec99e.png" alt="image-20191217163813035"></p> <h4 id="堆模式"><a href="#堆模式" class="header-anchor">#</a> 堆模式</h4> <p>数据存在 JVM 的堆内存中。</p> <ul><li>容易分配和释放</li> <li>可以直接访问其中的字节数据</li> <li>不利于与本地硬件进行数据传输，需要建立“中间缓冲区”</li></ul> <h4 id="直接模式"><a href="#直接模式" class="header-anchor">#</a> 直接模式</h4> <p>数据存在 JVM 的堆内存之外的本地系统内存中。</p> <ul><li>不容易分配和释放</li> <li>不受垃圾回收器的控制</li> <li>利于与本地硬件进行数据传输，自身就是一个“中间缓冲区”</li></ul> <blockquote><p>直接模式，也称为零拷贝模式，是 MMAP （内存映射）的一种应用，即数据不需要再从内核态拷贝到用户态，而是建立一种映射关系，进程通过这个映射直接操纵内核态里的数据。</p></blockquote> <h4 id="聚合模式"><a href="#聚合模式" class="header-anchor">#</a> 聚合模式</h4> <p>将多个缓冲区表示为单个合并缓冲区的虚拟表示。</p> <h3 id="bytebufholder"><a href="#bytebufholder" class="header-anchor">#</a> ByteBufHolder</h3> <p>相当一个官方标准，内部持有一个或多个 ByteBuf ，用于返回 ByteBuf 对象。</p> <h3 id="bytebufallocator"><a href="#bytebufallocator" class="header-anchor">#</a> ByteBufAllocator</h3> <p>用于分配各种模式的 ByteBuf 。自身通常需要数据通道来产生。</p> <ul><li>池化实现：PooledByteBufAllocator</li> <li>非池化实现：UnPooledByteBufAllocator</li></ul> <h3 id="unpooled"><a href="#unpooled" class="header-anchor">#</a> UnPooled</h3> <p>提供了静态的辅助方法来创建未池化的 ByteBuf 实例。</p> <h3 id="bytebufutil"><a href="#bytebufutil" class="header-anchor">#</a> ByteBufUtil</h3> <p>ByteBuf 的工具类</p> <h2 id="netty-数据通道"><a href="#netty-数据通道" class="header-anchor">#</a> Netty 数据通道</h2> <p><img src="/assets/img/channel.6bbb9fa3.svg" alt=""></p> <h3 id="channel"><a href="#channel" class="header-anchor">#</a> Channel</h3> <p>代表一个可以进行 I/O 操作（读写连绑）的通道。接口的方法与通道状态、ChannelConfig、I/O操作、ChannelPipeline、EventLoop 等有关。</p> <ul><li>所有与 I/O 操作相关的方法都是异步的，返回一个 ChannelFuture 对象</li> <li>内置一个 parent 通道，这取决于通道的创建过程</li> <li>Channel 只是一个通用标准，实际使用时经常需要向下转型成子类对象，以便调用特有的方法。</li></ul> <img src="data:image/png;base64,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" style="zoom:80%;"> <h3 id="channelhandler"><a href="#channelhandler" class="header-anchor">#</a> ChannelHandler</h3> <p>代表一个通道的处理器，用于对数据执行业务逻辑。</p> <p>相关行为概述：</p> <ul><li>ChannelHandler 包含了添加和删除处理器时会回调的方法</li> <li>ChannelInboundHandler 包含了通道状态改变、数据读取、出现异常时会回调的方法</li> <li>ChannelOutboundhandler 包含了通道状态改变、数据发送、出现异常时会回调的方法</li></ul> <p>Netty 使用引用计数来处理池化的 ByteBuf。所以在完全使用完某个 ByteBuf 后，调整其引用计数是很重要的。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelRead</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//...</span>
	<span class="token class-name">ReferenceCountUtil</span><span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">,</span> <span class="token class-name">ChannelPromise</span> promise<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//...</span>
	<span class="token class-name">ReferenceCountUtil</span><span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
	promise<span class="token punctuation">.</span><span class="token function">setSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="channelpipeline-和-channelhandlercontext"><a href="#channelpipeline-和-channelhandlercontext" class="header-anchor">#</a> ChannelPipeline 和 ChannelHandlerContext</h3> <p>ChannelPipeline 代表多个 handler 组成的一个处理链，抽象称为管道。每一个 Channel 都对应一个 ChannelPipeline 。每当一个 handler 添加进来后都会被包装成一个 ChannelHandlerContext，并加入到 ChannelPipeline 的双向链表中</p> <img src="/assets/img/channelpipeline.1306bf0b.png" style="zoom:80%;"> <blockquote><p>有两个特殊的 context 是默认存在的，HEAD、TAIL。所以逻辑上的第一个 handler ，其实是HEAD的下一个，最后一个 handler ，其实是 TAIL 的前一个。</p></blockquote> <p>相关行为概述：</p> <ul><li>context 和 pipeline 都含有了事件触发后的回调方法，即 Invoker 中的方法</li> <li>pipeline 还拥有管理 context 节点的相关方法</li></ul> <blockquote><p>@Sharable 修饰的 handler 可以被添加到多个 pipeline 中，此时要注意相应的并发问题。</p></blockquote> <h3 id="异常处理"><a href="#异常处理" class="header-anchor">#</a> 异常处理</h3> <ul><li>入站时，需要重写入站处理器的异常回调方法，并放到处理链靠后的位置上。</li> <li>出站时，相关回调方法都会有一个 promise 参数，可以通过它进行异步通知。</li></ul> <h2 id="netty-事件执行器"><a href="#netty-事件执行器" class="header-anchor">#</a> Netty 事件执行器</h2> <p><img src="/assets/img/eventloop.3352b6bd.svg" alt=""></p> <p>相关行为概述：</p> <ul><li>EventExecutorGroup 负责提供 EventExecutor</li> <li>EventExecutor 则代表一个事件执行器，其相关方法其实是从 EventExecutorGroup 继承来的</li> <li>EventLoopGroup 则负责提供 EventLoop</li> <li>EventLoop 代表一个事件循环，负责接收 Channel 并处理相关事件的发生，其相关方法其实也是从 EventLoopGroup 继承来的</li></ul> <img src="/assets/img/channel-eventloop.d91b9aed.png" style="zoom:80%;"> <blockquote><p>一个 EventLoop 可能被分配给多个 Channel</p></blockquote> <blockquote><p>在具体实现中，一个 EventLoop 将由一个永远不会变的线程驱动，在这个线程里，Channel 所发生的事件和相应的任务都会被这一个线程所执行，避免了代码同步的开销。</p> <ul><li>事件处理的顺序逻辑有 JDK NIO 实现多路复用</li> <li>任务处理的顺序逻辑是如果当前线程不是 EventLoop 线程，则在丢到一个任务队列前，会去尝试启动 EventLoop 线程。</li></ul></blockquote> <h2 id="netty-引导器"><a href="#netty-引导器" class="header-anchor">#</a> Netty 引导器</h2> <p>引导器负责对网络应用进行配置并将它运行起来。</p> <img src="/assets/img/boostrap.1633b868.png" style="zoom:80%;"> <blockquote><p>实现 Cloneable 的意义：有时可能会需要创建多个具有类似配置或者完全相同配置的 Channel 。</p></blockquote> <h3 id="bootstrap"><a href="#bootstrap" class="header-anchor">#</a> Bootstrap</h3> <p>用于客户端或者使用了无连接协议的应用程序中。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Bootstrap</span> bs <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
bs<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&lt;</span>group<span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> <span class="token comment">// 设置处理事件的 EventLoopGroup</span>
	<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&lt;</span>channelType<span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span>  <span class="token comment">// 指定Channel的实现类,一定要兼容 group</span>
	<span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&lt;</span>handler<span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 设置处理器，用于构建pipeline</span>
<span class="token class-name">ChannelFuture</span> future <span class="token operator">=</span> bs<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>
	<span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&lt;</span>host<span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&lt;</span>port<span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
futrue<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">closeFuture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>connect 流程</strong>：</p> <h3 id="serverbootstrap"><a href="#serverbootstrap" class="header-anchor">#</a> ServerBootstrap</h3> <p>用于服务器的应用程序中。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">ServerBootstrap</span> bs <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServerBootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 设置处理serverChannel事件和被接收的子channel事件的EventLoopGroup</span>
bs<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&lt;</span>bossGroup<span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&lt;</span>workGroup<span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&lt;</span>serverChannelType<span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> <span class="token comment">// 指定serverChannel的实现类</span>
    <span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&lt;</span>handler<span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> <span class="token comment">// ServerChannel的ChannelPipeline中的ChannelHandler</span>
    <span class="token punctuation">.</span><span class="token function">childHandler</span><span class="token punctuation">(</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&lt;</span>childHandler<span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 子Channel的ChannelPipeline中的ChannelHandler</span>
<span class="token class-name">ChannelFuture</span> future <span class="token operator">=</span> bs<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&lt;</span>port<span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
future<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">closeFuture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>bind 流程</strong>：</p> <h2 id="netty-编解码器"><a href="#netty-编解码器" class="header-anchor">#</a> Netty 编解码器</h2> <p>编码器操作出站数据，属于出站处理器，而解码器处理入站数据，属于入站处理器。</p> <h3 id="解码器"><a href="#解码器" class="header-anchor">#</a> 解码器</h3> <h4 id="bytetomessagedecoder"><a href="#bytetomessagedecoder" class="header-anchor">#</a> ByteToMessageDecoder</h4> <ul><li><code>void decode(ChannelHandlerContext ctx, ByteBuf in, List&lt;Object&gt; out)</code></li> <li><code>void decodeLast(ChannelHandlerContext ctx, ByteBuf in, List&lt;Object&gt; out)</code></li></ul> <h4 id="messagetomessagedecoder-i"><a href="#messagetomessagedecoder-i" class="header-anchor">#</a> MessageToMessageDecoder&lt;I&gt;</h4> <ul><li><code>void decode(ChannelHandlerContext ctx, I msg, List&lt;Object&gt; out)</code></li></ul> <h3 id="编码器"><a href="#编码器" class="header-anchor">#</a> 编码器</h3> <h4 id="messagetobyteencoder-i"><a href="#messagetobyteencoder-i" class="header-anchor">#</a> MessageToByteEncoder&lt;I&gt;</h4> <ul><li><code>void encode(ChannelHandlerContext ctx, I msg, ByteBuf out)</code></li></ul> <h4 id="messagetomessageencoder-i"><a href="#messagetomessageencoder-i" class="header-anchor">#</a> MessageToMessageEncoder&lt;I&gt;</h4> <ul><li><code>encode(ChannelHandlerContext ctx, I msg, List&lt;Object&gt; out)</code></li></ul> <h3 id="编解码器"><a href="#编解码器" class="header-anchor">#</a> 编解码器</h3> <h4 id="bytetomessagecodec-i"><a href="#bytetomessagecodec-i" class="header-anchor">#</a> ByteToMessageCodec&lt;I&gt;</h4> <ul><li><code>void decode(ChannelHandlerContext ctx, ByteBuf in, List&lt;Object&gt; out)</code></li> <li><code>void decodeLast(ChannelHandlerContext ctx, ByteBuf in, List&lt;Object&gt; out)</code></li> <li><code>void encode(ChannelHandlerContext ctx, I msg, ByteBuf out)</code></li></ul> <h4 id="messagetomessagecodec-inbound-in-outbound-in"><a href="#messagetomessagecodec-inbound-in-outbound-in" class="header-anchor">#</a> MessageToMessageCodec&lt;INBOUND_IN,OUTBOUND_IN&gt;</h4> <ul><li><code>void encode(ChannelHandlerContext ctx, OUTBOUND_IN msg, List&lt;Object&gt; out)</code></li> <li><code>void decode(ChannelHandlerContext ctx, INBOUND_IN msg, List&lt;Object&gt; out)</code></li></ul> <h2 id="channelhandler-2"><a href="#channelhandler-2" class="header-anchor">#</a> ChannelHandler</h2> <p><img src="/assets/img/channelhandler.b4ad8559.svg" alt=""></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ChannelHandler</span> <span class="token punctuation">{</span>
    <span class="token comment">//...</span>
    <span class="token keyword">void</span> <span class="token function">handlerAdded</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">handlerRemoved</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">;</span>
    <span class="token comment">//...</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">ChannelHandlerAdapter</span> <span class="token punctuation">{</span>
    <span class="token comment">//...</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isSharable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> clazz <span class="token operator">=</span> <span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Class</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span> <span class="token class-name">Boolean</span><span class="token punctuation">&gt;</span></span> cache <span class="token operator">=</span> <span class="token class-name">InternalThreadLocalMap</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handlerSharableCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Boolean</span> sharable <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>clazz<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>sharable <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            sharable <span class="token operator">=</span> clazz<span class="token punctuation">.</span><span class="token function">isAnnotationPresent</span><span class="token punctuation">(</span><span class="token class-name">Sharable</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            cache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>clazz<span class="token punctuation">,</span> sharable<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> sharable<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//...</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="channelinboundhandler"><a href="#channelinboundhandler" class="header-anchor">#</a> ChannelInboundHandler</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ChannelInboundHandler</span> <span class="token keyword">extends</span> <span class="token class-name">ChannelHandler</span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">channelRegistered</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">channelUnregistered</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">channelActive</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">channelInactive</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">channelRead</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">channelReadComplete</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">userEventTriggered</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> evt<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">channelWritabilityChanged</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">exceptionCaught</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Throwable</span> cause<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ChannelInboundHandlerAdapter</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">void</span> <span class="token function">xxx</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        ctx<span class="token punctuation">.</span><span class="token function">fireXxx</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="channelinitializer"><a href="#channelinitializer" class="header-anchor">#</a> ChannelInitializer</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">C</span> <span class="token keyword">extends</span> <span class="token class-name">Channel</span><span class="token punctuation">&gt;</span></span>
    	<span class="token keyword">extends</span> <span class="token class-name">ChannelInboundHandlerAdapter</span> <span class="token punctuation">{</span>
    
<span class="token punctuation">}</span>
</code></pre></div><h4 id="simplechannelinboundhandler"><a href="#simplechannelinboundhandler" class="header-anchor">#</a> SimpleChannelInboundHandler</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">SimpleChannelInboundHandler</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">I</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">ChannelInboundHandlerAdapter</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelRead</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token keyword">boolean</span> release <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">acceptInboundMessage</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">&quot;unchecked&quot;</span><span class="token punctuation">)</span>
                <span class="token class-name">I</span> imsg <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">I</span><span class="token punctuation">)</span> msg<span class="token punctuation">;</span>
                <span class="token function">channelRead0</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> imsg<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                release <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                ctx<span class="token punctuation">.</span><span class="token function">fireChannelRead</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>autoRelease <span class="token operator">&amp;&amp;</span> release<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">ReferenceCountUtil</span><span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">protected</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">channelRead0</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">I</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="channeloutboundhandler"><a href="#channeloutboundhandler" class="header-anchor">#</a> ChannelOutboundHandler</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ChannelOutboundHandler</span> <span class="token keyword">extends</span> <span class="token class-name">ChannelHandler</span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">bind</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">SocketAddress</span> localAddress<span class="token punctuation">,</span> <span class="token class-name">ChannelPromise</span> promise<span class="token punctuation">)</span> 
        	<span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">connect</span><span class="token punctuation">(</span>
            <span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">SocketAddress</span> remoteAddress<span class="token punctuation">,</span>
            <span class="token class-name">SocketAddress</span> localAddress<span class="token punctuation">,</span> <span class="token class-name">ChannelPromise</span> promise<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">ChannelPromise</span> promise<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">ChannelPromise</span> promise<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">deregister</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">ChannelPromise</span> promise<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">,</span> <span class="token class-name">ChannelPromise</span> promise<span class="token punctuation">)</span>
        	<span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">flush</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ChannelOutboundHandlerAdapter</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">void</span> <span class="token function">xxx</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        ctx<span class="token punctuation">.</span><span class="token function">xxx</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="channelduplexhandler"><a href="#channelduplexhandler" class="header-anchor">#</a> ChannelDuplexHandler</h3> <h4 id="combinedchannelduplexhandler"><a href="#combinedchannelduplexhandler" class="header-anchor">#</a> CombinedChannelDuplexHandler</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CombinedChannelDuplexHandler</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">I</span> <span class="token keyword">extends</span> <span class="token class-name">ChannelInboundHandler</span><span class="token punctuation">,</span>
										  <span class="token class-name">O</span> <span class="token keyword">extends</span> <span class="token class-name">ChannelOutboundHandler</span><span class="token punctuation">&gt;</span></span>
        <span class="token keyword">extends</span> <span class="token class-name">ChannelDuplexHandler</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handlerAdded</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>inboundHandler <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span>
                    <span class="token string">&quot;init() must be invoked before being added to a &quot;</span> <span class="token operator">+</span> <span class="token class-name">ChannelPipeline</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getSimpleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span>
                            <span class="token string">&quot; if &quot;</span> <span class="token operator">+</span>  <span class="token class-name">CombinedChannelDuplexHandler</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getSimpleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span>
                            <span class="token string">&quot; was constructed with the default constructor.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        outboundCtx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DelegatingChannelHandlerContext</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> outboundHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>
        inboundCtx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DelegatingChannelHandlerContext</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> inboundHandler<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">&quot;deprecation&quot;</span><span class="token punctuation">)</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token class-name">ChannelHandlerContext</span> <span class="token function">fireExceptionCaught</span><span class="token punctuation">(</span><span class="token class-name">Throwable</span> cause<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>outboundCtx<span class="token punctuation">.</span>removed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">try</span> <span class="token punctuation">{</span>
                        <span class="token comment">// We directly delegate to the ChannelOutboundHandler as this may override exceptionCaught(...)</span>
                        <span class="token comment">// as well</span>
                        outboundHandler<span class="token punctuation">.</span><span class="token function">exceptionCaught</span><span class="token punctuation">(</span>outboundCtx<span class="token punctuation">,</span> cause<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>logger<span class="token punctuation">.</span><span class="token function">isDebugEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span>
                                    <span class="token string">&quot;An exception {}&quot;</span> <span class="token operator">+</span>
                                    <span class="token string">&quot;was thrown by a user handler's exceptionCaught() &quot;</span> <span class="token operator">+</span>
                                    <span class="token string">&quot;method while handling the following exception:&quot;</span><span class="token punctuation">,</span>
                                    <span class="token class-name">ThrowableUtil</span><span class="token punctuation">.</span><span class="token function">stackTraceToString</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">,</span> cause<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>logger<span class="token punctuation">.</span><span class="token function">isWarnEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            logger<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span>
                                    <span class="token string">&quot;An exception '{}' [enable DEBUG level for full stacktrace] &quot;</span> <span class="token operator">+</span>
                                    <span class="token string">&quot;was thrown by a user handler's exceptionCaught() &quot;</span> <span class="token operator">+</span>
                                    <span class="token string">&quot;method while handling the following exception:&quot;</span><span class="token punctuation">,</span> error<span class="token punctuation">,</span> cause<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">fireExceptionCaught</span><span class="token punctuation">(</span>cause<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token comment">// The inboundCtx and outboundCtx were created and set now it's safe to call removeInboundHandler() and</span>
        <span class="token comment">// removeOutboundHandler().</span>
        handlerAdded <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            inboundHandler<span class="token punctuation">.</span><span class="token function">handlerAdded</span><span class="token punctuation">(</span>inboundCtx<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            outboundHandler<span class="token punctuation">.</span><span class="token function">handlerAdded</span><span class="token punctuation">(</span>outboundCtx<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></div></div><div class="box"><div class="post-tags"><span class="post-tag ca-tag"><span><a class="firstca endcd" style="color: white">网络技术</a><!----></span></span><a class="ta-tag post-tag">学习笔记</a><a class="ta-tag post-tag">java</a><a class="ta-tag post-tag">netty</a><a class="ta-tag post-tag">network</a><span class="da-tag post-tag">2020.06.18</span><span class="uda-tag post-tag">2020.06.18</span></div></div><div class="box"><div id="vcomments"></div></div></div></div></div></div></main><div id="top-btn" class="btn" style="display:none;"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="arrow-up" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="svg-inline--fa fa-arrow-up fa-w-14 fa-lg"><path fill="currentColor" d="M34.9 289.5l-22.2-22.2c-9.4-9.4-9.4-24.6 0-33.9L207 39c9.4-9.4 24.6-9.4 33.9 0l194.3 194.3c9.4 9.4 9.4 24.6 0 33.9L413 289.4c-9.5 9.5-25 9.3-34.3-.4L264 168.6V456c0 13.3-10.7 24-24 24h-32c-13.3 0-24-10.7-24-24V168.6L69.2 289.1c-9.3 9.8-24.8 10-34.3.4z"></path></svg></div></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.2d05b873.js" defer></script><script src="/assets/js/9.fd2d7f08.js" defer></script><script src="/assets/js/3.5fc63a44.js" defer></script><script src="/assets/js/4.caf2fcbd.js" defer></script>
  </body>
</html>
