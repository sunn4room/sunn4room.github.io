<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Hibernate | sunn4room</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="icon" href="/favicon.png">
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.62005803.css" as="style"><link rel="preload" href="/assets/js/app.2d05b873.js" as="script"><link rel="preload" href="/assets/js/9.fd2d7f08.js" as="script"><link rel="preload" href="/assets/js/3.5fc63a44.js" as="script"><link rel="preload" href="/assets/js/15.0b8b74f4.js" as="script"><link rel="prefetch" href="/assets/js/10.50ae4a69.js"><link rel="prefetch" href="/assets/js/11.afdccb1f.js"><link rel="prefetch" href="/assets/js/12.0010c894.js"><link rel="prefetch" href="/assets/js/13.eb55877c.js"><link rel="prefetch" href="/assets/js/14.65cfc2ff.js"><link rel="prefetch" href="/assets/js/16.4dbb4aa4.js"><link rel="prefetch" href="/assets/js/17.271c05bb.js"><link rel="prefetch" href="/assets/js/18.4c3e94d0.js"><link rel="prefetch" href="/assets/js/19.1a0cddca.js"><link rel="prefetch" href="/assets/js/2.d45a9055.js"><link rel="prefetch" href="/assets/js/20.cdf7cb28.js"><link rel="prefetch" href="/assets/js/21.fbf2cd3f.js"><link rel="prefetch" href="/assets/js/22.42257d5f.js"><link rel="prefetch" href="/assets/js/23.e26a383f.js"><link rel="prefetch" href="/assets/js/24.d9c833cd.js"><link rel="prefetch" href="/assets/js/25.f8ca341b.js"><link rel="prefetch" href="/assets/js/26.a42edc25.js"><link rel="prefetch" href="/assets/js/27.0127ab0c.js"><link rel="prefetch" href="/assets/js/28.cd79c0d4.js"><link rel="prefetch" href="/assets/js/29.c3f37782.js"><link rel="prefetch" href="/assets/js/30.043d284c.js"><link rel="prefetch" href="/assets/js/31.423ed3ce.js"><link rel="prefetch" href="/assets/js/32.26519eb1.js"><link rel="prefetch" href="/assets/js/33.f57167ad.js"><link rel="prefetch" href="/assets/js/34.ecaa6ee5.js"><link rel="prefetch" href="/assets/js/35.47e91ee0.js"><link rel="prefetch" href="/assets/js/36.258a624f.js"><link rel="prefetch" href="/assets/js/37.68bb6fda.js"><link rel="prefetch" href="/assets/js/38.94239711.js"><link rel="prefetch" href="/assets/js/39.e83c38cf.js"><link rel="prefetch" href="/assets/js/4.caf2fcbd.js"><link rel="prefetch" href="/assets/js/40.acf21eb1.js"><link rel="prefetch" href="/assets/js/41.d164530a.js"><link rel="prefetch" href="/assets/js/5.886701df.js"><link rel="prefetch" href="/assets/js/6.61d8e906.js"><link rel="prefetch" href="/assets/js/7.177acf7a.js"><link rel="prefetch" href="/assets/js/8.84396220.js">
    <link rel="stylesheet" href="/assets/css/0.styles.62005803.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="app"><div id="header"><img id="hero" src="/assets/img/hero.470debc7.png"><span id="title">Hibernate</span><div id="search-box" class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div><aside id="aside"><div class="__vuescroll" style="height:100%;width:100%;padding:0;position:relative;overflow:hidden;"><div class="__panel __hidebar" style="position:relative;box-sizing:border-box;height:100%;overflow-y:hidden;overflow-x:hidden;transform-origin:;transform:;"><div class="__view" style="position:relative;box-sizing:border-box;min-width:100%;min-height:100%;"><div class="margin-box"><div class="white-line"></div><div class="shell"><div class="sh-header"><div class="dot" style="background-color: #e9524a"></div><div class="dot" style="background-color: #f1ae1b"></div><div class="dot" style="background-color: #59c837"></div></div><div class="sh-body"><div class="line"><span>&gt; </span><span style="color:#4ebdcf">Who are you?</span></div><div class="line right"><span style="color:#97d209">I'm sunn4room</span><span> &lt;</span></div><div class="line right"><span style="color:#97d209">em... Just Sunny Room</span><span> &lt;</span></div><div class="line right"><span style="color:#97d209">And you?</span><span class="cursor">a</span><span> &lt;</span></div></div></div><div class="header-tag" style="font-size:1rem;font-weight:bold;margin-top:1.5rem;">Hibernate</div><a href="#hello-hibernate" class="header-tag" style="font-size:1rem;margin-left:1rem;">Hello Hibernate</a><a href="#hibernate-配置" class="header-tag" style="font-size:1rem;margin-left:1rem;">Hibernate 配置</a><a href="#po-映射" class="header-tag" style="font-size:1rem;margin-left:1rem;">PO 映射</a><a href="#类映射" class="header-tag" style="font-size:1rem;margin-left:2rem;">类映射</a><a href="#属性映射" class="header-tag" style="font-size:1rem;margin-left:2rem;">属性映射</a><a href="#集合属性映射" class="header-tag" style="font-size:1rem;margin-left:2rem;">集合属性映射</a><a href="#组件属性映射" class="header-tag" style="font-size:1rem;margin-left:2rem;">组件属性映射</a><a href="#关联映射" class="header-tag" style="font-size:1rem;margin-left:2rem;">关联映射</a><a href="#_1-1" class="header-tag" style="font-size:1rem;margin-left:3rem;">1 &gt; 1</a><a href="#_1-n" class="header-tag" style="font-size:1rem;margin-left:3rem;">1 &gt; N</a><a href="#n-1" class="header-tag" style="font-size:1rem;margin-left:3rem;">N &gt; 1</a><a href="#n-n" class="header-tag" style="font-size:1rem;margin-left:3rem;">N &gt; N</a><a href="#继承映射" class="header-tag" style="font-size:1rem;margin-left:2rem;">继承映射</a><a href="#单表-默认" class="header-tag" style="font-size:1rem;margin-left:3rem;">单表（默认）</a><a href="#多表关联" class="header-tag" style="font-size:1rem;margin-left:3rem;">多表关联</a><a href="#多表分离" class="header-tag" style="font-size:1rem;margin-left:3rem;">多表分离</a><a href="#java-api" class="header-tag" style="font-size:1rem;margin-left:1rem;">Java API</a><a href="#po-的状态" class="header-tag" style="font-size:1rem;margin-left:2rem;">PO 的状态</a><a href="#jpql" class="header-tag" style="font-size:1rem;margin-left:2rem;">JPQL</a><a href="#动态条件查询" class="header-tag" style="font-size:1rem;margin-left:2rem;">动态条件查询</a><a href="#锁" class="header-tag" style="font-size:1rem;margin-left:2rem;">锁</a><a href="#事务" class="header-tag endtag" style="font-size:1rem;margin-left:2rem;">事务</a></div></div></div></div></aside><div id="curtain"></div><main id="main"><div class="__vuescroll" style="height:100%;width:100%;padding:0;position:relative;overflow:hidden;"><div class="__panel __hidebar" style="position:relative;box-sizing:border-box;height:100%;overflow-y:hidden;overflow-x:hidden;transform-origin:;transform:;"><div class="__view" style="position:relative;box-sizing:border-box;min-width:100%;min-height:100%;"><div class="margin-box"><div class="white-line"></div><div class="box"><div class="post-tags"><span class="post-tag ca-tag"><span><a class="firstca" style="color: white">程序设计</a><span><svg aria-hidden="true" focusable="false" data-prefix="fa" data-icon="caret-right" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 192 512" class="svg-inline--fa fa-caret-right fa-w-6" style="width:1rem;"><path fill="currentColor" d="M0 384.662V127.338c0-17.818 21.543-26.741 34.142-14.142l128.662 128.662c7.81 7.81 7.81 20.474 0 28.284L34.142 398.804C21.543 411.404 0 402.48 0 384.662z"></path></svg></span></span><span><a class="endcd" style="color: white">Java</a><!----></span></span><a class="ta-tag post-tag">jpa</a><a class="ta-tag post-tag">java</a><a class="ta-tag post-tag">hibernate</a><span class="da-tag post-tag">2020.08.29</span><!----></div></div><div class="box"><h1 style="text-align:center;">Hibernate</h1><div class="markdown-body content__default"><h1 id="hibernate"><a href="#hibernate" class="header-anchor">#</a> Hibernate</h1> <p>Hibernate 解决了关系数据库和面向对象程序设计之间的映射问题，使得开发者可以通过面向对象的方式解决关系型数据持久化问题。JPA 提出后，Hibernate 全面拥抱 JPA 标准。</p> <p><img src="/assets/img/data_access_layers.3fdab150.svg" alt="Data Access Layers"></p> <h2 id="hello-hibernate"><a href="#hello-hibernate" class="header-anchor">#</a> Hello Hibernate</h2> <p>持久化对象</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>sunny<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>entity</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>persistence<span class="token punctuation">.</span></span><span class="token class-name">Entity</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>persistence<span class="token punctuation">.</span></span><span class="token class-name">GeneratedValue</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>persistence<span class="token punctuation">.</span></span><span class="token class-name">GenerationType</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>persistence<span class="token punctuation">.</span></span><span class="token class-name">Id</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>persistence<span class="token punctuation">.</span></span><span class="token class-name">Table</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Entity</span>
<span class="token annotation punctuation">@Table</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Id</span>
    <span class="token annotation punctuation">@GeneratedValue</span><span class="token punctuation">(</span>strategy <span class="token operator">=</span> <span class="token class-name">GenerationType</span><span class="token punctuation">.</span>IDENTITY<span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setId</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>id<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>使用 JPA API</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token comment">&lt;!-- META-INF/persistence.xml --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>persistence</span>
    <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://java.sun.com/xml/ns/persistence<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://java.sun.com/xml/ns/persistence http://java.sun.com/xml/ns/persistence/persistence_2_0.xsd<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>2.0<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>persistence-unit</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.sunny.hibernate<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>provider</span><span class="token punctuation">&gt;</span></span>org.hibernate.jpa.HibernatePersistenceProvider<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>provider</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>class</span><span class="token punctuation">&gt;</span></span>com.sunny.hibernate.entity.User<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>class</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hibernate.connection.driver_class<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.mysql.cj.jdbc.Driver<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hibernate.connection.url<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>jdbc:mysql://localhost:3306/hibernate<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hibernate.connection.username<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>root<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hibernate.connection.password<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>888888<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hibernate.dialect<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.hibernate.dialect.MySQL8Dialect<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hibernate.show_sql<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hibernate.format_sql<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hibernate.hbm2ddl.auto<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>update<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>persistence-unit</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>persistence</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>sunny<span class="token punctuation">.</span>hibernate</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>persistence<span class="token punctuation">.</span></span><span class="token class-name">EntityManager</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>persistence<span class="token punctuation">.</span></span><span class="token class-name">EntityManagerFactory</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>persistence<span class="token punctuation">.</span></span><span class="token class-name">Persistence</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>sunny<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">User</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">EntityManagerFactory</span> fac <span class="token operator">=</span> <span class="token class-name">Persistence</span><span class="token punctuation">.</span><span class="token function">createEntityManagerFactory</span><span class="token punctuation">(</span><span class="token string">&quot;com.sunny.hibernate&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">EntityManager</span> em <span class="token operator">=</span> fac<span class="token punctuation">.</span><span class="token function">createEntityManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        em<span class="token punctuation">.</span><span class="token function">getTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">User</span> u1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        u1<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;sunny&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        em<span class="token punctuation">.</span><span class="token function">persist</span><span class="token punctuation">(</span>u1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        em<span class="token punctuation">.</span><span class="token function">getTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        em<span class="token punctuation">.</span><span class="token function">getTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">User</span> u2 <span class="token operator">=</span> em<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>u2<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        u2<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;sunnysunny&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        em<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        em<span class="token punctuation">.</span><span class="token function">getTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        em<span class="token punctuation">.</span><span class="token function">getTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">User</span> u3 <span class="token operator">=</span> em<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>u3<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        em<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>u3<span class="token punctuation">)</span><span class="token punctuation">;</span>
        em<span class="token punctuation">.</span><span class="token function">getTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        em<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        fac<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="hibernate-配置"><a href="#hibernate-配置" class="header-anchor">#</a> Hibernate 配置</h2> <table><thead><tr><th style="text-align:left;">属性</th> <th style="text-align:left;"><strong>描述</strong></th></tr></thead> <tbody><tr><td style="text-align:left;"><strong>hibernate.dialect</strong></td> <td style="text-align:left;">这个属性使 Hibernate 应用为被选择的数据库生成适当的 SQL。</td></tr> <tr><td style="text-align:left;"><strong>hibernate.connection.driver_class</strong></td> <td style="text-align:left;">JDBC 驱动程序类。</td></tr> <tr><td style="text-align:left;"><strong>hibernate.connection.url</strong></td> <td style="text-align:left;">数据库实例的 JDBC URL。</td></tr> <tr><td style="text-align:left;"><strong>hibernate.connection.username</strong></td> <td style="text-align:left;">数据库用户名。</td></tr> <tr><td style="text-align:left;"><strong>hibernate.connection.password</strong></td> <td style="text-align:left;">数据库密码。</td></tr> <tr><td style="text-align:left;"><strong>hibernate.connection.autocommit</strong></td> <td style="text-align:left;">允许在 JDBC 连接中使用自动提交模式。</td></tr> <tr><td style="text-align:left;"><strong>hibernate.max_fetch_depth</strong></td> <td style="text-align:left;">关联映射中的外连接抓取深度</td></tr> <tr><td style="text-align:left;"><strong>hibernate.show_sql</strong></td> <td style="text-align:left;">输出所有SQL语句到控制台</td></tr> <tr><td style="text-align:left;"><strong>hibernate.format_sql</strong></td> <td style="text-align:left;">在log和console中打印出更漂亮的SQL</td></tr> <tr><td style="text-align:left;"><strong>hibernate.jdbc.fetch_size</strong></td> <td style="text-align:left;">指定JDBC抓取数量的大小</td></tr> <tr><td style="text-align:left;"><strong>hibernate.jdbc.batch_size</strong></td> <td style="text-align:left;">允许Hibernate使用JDBC2的批量更新的大小</td></tr> <tr><td style="text-align:left;"><strong>hibernate.hbm2ddl.auto</strong></td> <td style="text-align:left;">update、create、create-drop</td></tr> <tr><td style="text-align:left;"><strong>hibernate.cache.use_second_level_cache</strong></td> <td style="text-align:left;">二级缓存开关</td></tr> <tr><td style="text-align:left;"><strong>hibernate.cache.use_query_cache</strong></td> <td style="text-align:left;">查询缓存开关（不建议开启，影响性能）</td></tr></tbody></table> <h2 id="po-映射"><a href="#po-映射" class="header-anchor">#</a> PO 映射</h2> <p>Hibernate 的 PO 映射推荐采用 JPA 的映射注解</p> <h3 id="类映射"><a href="#类映射" class="header-anchor">#</a> 类映射</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Entity</span>
<span class="token annotation punctuation">@Table</span><span class="token punctuation">(</span>
    name <span class="token operator">=</span> <span class="token string">&quot;xxx&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 表名</span>
    indexes <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Index</span><span class="token punctuation">(</span>
            name <span class="token operator">=</span> <span class="token string">&quot;xxx&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 索引名</span>
            columnList <span class="token operator">=</span> <span class="token string">&quot;xxx,xxx&quot;</span><span class="token punctuation">,</span>
            unique <span class="token operator">=</span> <span class="token boolean">true</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    uniqueConstraints <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@UniqueConstraint</span><span class="token punctuation">(</span>
            name <span class="token operator">=</span> <span class="token string">&quot;xxx&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 唯一约束名</span>
            columnNames <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;xxx&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;xxx&quot;</span><span class="token punctuation">}</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Xxx</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="属性映射"><a href="#属性映射" class="header-anchor">#</a> 属性映射</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// ...</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Xxx</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Id</span>
    <span class="token annotation punctuation">@GeneratedValue</span><span class="token punctuation">(</span>
        strategy <span class="token operator">=</span> <span class="token class-name">GenerationType</span><span class="token punctuation">.</span>IDENTITY
    <span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Xxx</span> xxx<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>
        name <span class="token operator">=</span> <span class="token string">&quot;xxx&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 列名</span>
        nullable <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 是否允许为空</span>
    <span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Basic</span> <span class="token comment">// 可有可无，可以定义抓取策略</span>
    <span class="token keyword">private</span> <span class="token class-name">Xxx</span> xxx<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Temporal</span><span class="token punctuation">(</span><span class="token class-name">TemporalType</span><span class="token punctuation">.</span>TIMESTAMP<span class="token punctuation">)</span> <span class="token comment">// DATE | TIME | TIMESTAMP</span>
    <span class="token keyword">private</span> <span class="token class-name">Date</span> xxx<span class="token punctuation">;</span>
    
    <span class="token annotation punctuation">@Lob</span>
    <span class="token keyword">private</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> xxx<span class="token punctuation">;</span>
    
    <span class="token annotation punctuation">@Version</span> <span class="token comment">// 乐观锁</span>
    <span class="token keyword">private</span> <span class="token keyword">long</span> version<span class="token punctuation">;</span>
    
    <span class="token annotation punctuation">@Transient</span> <span class="token comment">// 不持久化</span>
    <span class="token keyword">private</span> <span class="token class-name">Xxx</span> xxx<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="集合属性映射"><a href="#集合属性映射" class="header-anchor">#</a> 集合属性映射</h3> <p>集合属性需要声明为接口类型，如 Set、List、Map，因为持久化时，Hibernate 会用自己的实现类赋值</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// ...</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Xxx</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@ElementCollection</span><span class="token punctuation">(</span>fetch <span class="token operator">=</span> <span class="token class-name">FetchType</span><span class="token punctuation">.</span>LAZY<span class="token punctuation">)</span> <span class="token comment">// EAGER | LAZY</span>
    <span class="token annotation punctuation">@CollectionTable</span><span class="token punctuation">(</span>
        name <span class="token operator">=</span> <span class="token string">&quot;xxx&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 集合表名</span>
        joinColumns <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@JoinColumn</span><span class="token punctuation">(</span>
                name <span class="token operator">=</span> <span class="token string">&quot;xxx&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 外键列名</span>
                referencedColumnName <span class="token operator">=</span> <span class="token string">&quot;xxx&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 主键列名</span>
                nullable <span class="token operator">=</span> <span class="token boolean">false</span>
            <span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;xxx&quot;</span><span class="token punctuation">,</span> nullable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Xxx</span><span class="token punctuation">&gt;</span></span> xxx<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// ...</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Xxx</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@ElementCollection</span><span class="token punctuation">(</span>fetch <span class="token operator">=</span> <span class="token class-name">FetchType</span><span class="token punctuation">.</span>LAZY<span class="token punctuation">)</span> <span class="token comment">// EAGER | LAZY</span>
    <span class="token annotation punctuation">@CollectionTable</span><span class="token punctuation">(</span>
        name <span class="token operator">=</span> <span class="token string">&quot;xxx&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 集合表名</span>
        joinColumns <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@JoinColumn</span><span class="token punctuation">(</span>
                name <span class="token operator">=</span> <span class="token string">&quot;xxx&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 外键列名</span>
                referencedColumnName <span class="token operator">=</span> <span class="token string">&quot;xxx&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 主键列名</span>
                nullable <span class="token operator">=</span> <span class="token boolean">false</span>
            <span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;xxx&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@OrderColumn</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;xxx&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Xxx</span><span class="token punctuation">&gt;</span></span> xxx<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// ...</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Xxx</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@ElementCollection</span><span class="token punctuation">(</span>fetch <span class="token operator">=</span> <span class="token class-name">FetchType</span><span class="token punctuation">.</span>LAZY<span class="token punctuation">)</span> <span class="token comment">// EAGER | LAZY</span>
    <span class="token annotation punctuation">@CollectionTable</span><span class="token punctuation">(</span>
        name <span class="token operator">=</span> <span class="token string">&quot;xxx&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 集合表名</span>
        joinColumns <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@JoinColumn</span><span class="token punctuation">(</span>
                name <span class="token operator">=</span> <span class="token string">&quot;xxx&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 外键列名</span>
                referencedColumnName <span class="token operator">=</span> <span class="token string">&quot;xxx&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 主键列名</span>
                nullable <span class="token operator">=</span> <span class="token boolean">false</span>
            <span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;xxx&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@MapKeyColumn</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;xxx&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Xxx</span><span class="token punctuation">,</span> <span class="token class-name">Xxx</span><span class="token punctuation">&gt;</span></span> xxx<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="组件属性映射"><a href="#组件属性映射" class="header-anchor">#</a> 组件属性映射</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Embeddable</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Exx</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;xxx&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Xxx</span> xxx<span class="token punctuation">;</span>
    <span class="token comment">// ...</span>
    <span class="token annotation punctuation">@Parent</span>
    praivate <span class="token class-name">Xxx</span> owner<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Entity</span>
<span class="token comment">// ...</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Xxx</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token keyword">private</span> <span class="token class-name">Exx</span> xxx<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>当集合属性的元素或者 Map 的键是组件的话，不需要再定义 @Column 和 @MapKeyColumn</p></blockquote> <h3 id="关联映射"><a href="#关联映射" class="header-anchor">#</a> 关联映射</h3> <h4 id="_1-1"><a href="#_1-1" class="header-anchor">#</a> 1 &gt; 1</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// ...</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Xxx</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@OneToOne</span><span class="token punctuation">(</span>
        targetEntity <span class="token operator">=</span> <span class="token class-name">Xxx</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>
        cascade <span class="token operator">=</span> <span class="token class-name">CascadeType</span><span class="token punctuation">.</span>ALL <span class="token comment">// ALL | PERSIST | MERGE | REMOVE | REFRESH | DETACH</span>
    <span class="token punctuation">)</span>
    <span class="token annotation punctuation">@JoinColumn</span><span class="token punctuation">(</span>
        name <span class="token operator">=</span> <span class="token string">&quot;xxx&quot;</span><span class="token punctuation">,</span>
        referencedColumnName <span class="token operator">=</span> <span class="token string">&quot;xxx&quot;</span><span class="token punctuation">,</span>
        unique <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Xxx</span> xxx<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>当双向关联时</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// ...</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Xxx</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@OneToOne</span><span class="token punctuation">(</span>mappedBy <span class="token operator">=</span> <span class="token string">&quot;xxx&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 另一端的属性名</span>
    <span class="token keyword">private</span> <span class="token class-name">Xxx</span> xxx<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></blockquote> <h4 id="_1-n"><a href="#_1-n" class="header-anchor">#</a> 1 &gt; N</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// ...</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Xxx</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@OneToMany</span>
    <span class="token annotation punctuation">@JoinColumn</span><span class="token punctuation">(</span> <span class="token comment">// 注意，这里的外键列是存在另一端的</span>
        name <span class="token operator">=</span> <span class="token string">&quot;xxx&quot;</span><span class="token punctuation">,</span>
        referencedColumnName <span class="token operator">=</span> <span class="token string">&quot;xxx&quot;</span>
    <span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Xxx</span><span class="token punctuation">&gt;</span></span> xxx<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>当双向关联时</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// ...</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Xxx</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@OneToMany</span><span class="token punctuation">(</span>mappedBy <span class="token operator">=</span> <span class="token string">&quot;xxx&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 另一端的属性名</span>
    <span class="token keyword">private</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Xxx</span><span class="token punctuation">&gt;</span></span> xxx<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></blockquote> <h4 id="n-1"><a href="#n-1" class="header-anchor">#</a> N &gt; 1</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// ...</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Xxx</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@ManyToOne</span>
    <span class="token annotation punctuation">@JoinColumn</span><span class="token punctuation">(</span>
        name <span class="token operator">=</span> <span class="token string">&quot;xxx&quot;</span><span class="token punctuation">,</span>
        referencedColumnName <span class="token operator">=</span> <span class="token string">&quot;xxx&quot;</span><span class="token punctuation">,</span>
        nullable <span class="token operator">=</span> <span class="token boolean">false</span>
    <span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Xxx</span> xxx<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="n-n"><a href="#n-n" class="header-anchor">#</a> N &gt; N</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// ...</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Xxx</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@ManyToMany</span>
    <span class="token annotation punctuation">@JoinTable</span><span class="token punctuation">(</span>
        name <span class="token operator">=</span> <span class="token string">&quot;xxx&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 连接表名</span>
        joinColumns <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@JoinColumn</span><span class="token punctuation">(</span>
                name <span class="token operator">=</span> <span class="token string">&quot;xxx&quot;</span><span class="token punctuation">,</span>
                referencedColumnName <span class="token operator">=</span> <span class="token string">&quot;xxx&quot;</span>
            <span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        inverseJoinColumns <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@JoinColumn</span><span class="token punctuation">(</span>
                name <span class="token operator">=</span> <span class="token string">&quot;xxx&quot;</span><span class="token punctuation">,</span>
                referencedColumnName <span class="token operator">=</span> <span class="token string">&quot;xxx&quot;</span>
            <span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="继承映射"><a href="#继承映射" class="header-anchor">#</a> 继承映射</h3> <h4 id="单表-默认"><a href="#单表-默认" class="header-anchor">#</a> 单表（默认）</h4> <p>在根类上增加辨识者列，用于区分父类和子类</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Entity</span>
<span class="token annotation punctuation">@DiscriminatorColumn</span><span class="token punctuation">(</span>
    name <span class="token operator">=</span> <span class="token string">&quot;xxx&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 辨识者列名</span>
<span class="token punctuation">)</span>
<span class="token annotation punctuation">@DiscriminatorValue</span><span class="token punctuation">(</span><span class="token string">&quot;xxx&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 辨识字符串</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Fxx</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Entity</span>
<span class="token annotation punctuation">@DiscriminatorValue</span><span class="token punctuation">(</span><span class="token string">&quot;xxx&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 辨识字符串</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Cxx</span> <span class="token keyword">extends</span> <span class="token class-name">Fxx</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="多表关联"><a href="#多表关联" class="header-anchor">#</a> 多表关联</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 根类</span>
<span class="token annotation punctuation">@Inheritance</span><span class="token punctuation">(</span>stratigy <span class="token operator">=</span> <span class="token class-name">InheritanceType</span><span class="token punctuation">.</span>JOINED<span class="token punctuation">)</span>
</code></pre></div><h4 id="多表分离"><a href="#多表分离" class="header-anchor">#</a> 多表分离</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 根类</span>
<span class="token annotation punctuation">@Inheritance</span><span class="token punctuation">(</span>stratigy <span class="token operator">=</span> <span class="token class-name">InheritanceType</span><span class="token punctuation">.</span>TABLE_PER_CLASS<span class="token punctuation">)</span>
</code></pre></div><blockquote><p>因为数据分离了，所以不能使用自增主键</p></blockquote> <h2 id="java-api"><a href="#java-api" class="header-anchor">#</a> Java API</h2> <h3 id="po-的状态"><a href="#po-的状态" class="header-anchor">#</a> PO 的状态</h3> <p>EntityManager 代表一个持久化上下文，PO根据与上下文的关系分为以下 4 种状态：</p> <ul><li><strong>瞬态</strong>：已完成实例化，但未与上下文关联。</li> <li><strong>持久态</strong>：已与上下文关联，关联或修改都会将被 Hibernate 检测到，并转换成持久化操作。</li> <li><strong>脱管态</strong>：与上下文关联断开后，对象仍然存在于内存中，对它的修改不会立即生效，直到再次和上下文关联，还是会转换成持久化操作的。</li> <li><strong>删除态</strong>：关联期间被执行删除操作，对象仍然存在于内存中，对它的修改不会生效。</li></ul> <p><img src="/assets/img/hibernate-jpa-api.17ece140.svg" alt=""></p> <blockquote><p>merge 会生成一个新的持久态对象</p></blockquote> <h3 id="jpql"><a href="#jpql" class="header-anchor">#</a> JPQL</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">String</span> jpql <span class="token operator">=</span> <span class="token string">&quot;update User set name = :newName where age &gt; 30&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> count <span class="token operator">=</span> em<span class="token punctuation">.</span><span class="token function">createQuery</span><span class="token punctuation">(</span>jpql<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setParameter</span><span class="token punctuation">(</span><span class="token string">&quot;newName&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;xxx&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">executeUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// delete 同理</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">String</span> jpql <span class="token operator">=</span> <span class="token string">&quot;select User from User where age &gt; :age&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> users <span class="token operator">=</span> em<span class="token punctuation">.</span><span class="token function">createQuery</span><span class="token punctuation">(</span>jpql<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setParameter</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResultList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">User</span> user <span class="token operator">=</span> em<span class="token punctuation">.</span><span class="token function">createQuery</span><span class="token punctuation">(</span>jpql<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setParameter</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSingleResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="动态条件查询"><a href="#动态条件查询" class="header-anchor">#</a> 动态条件查询</h3> <p>动态条件查询提供了编程式的类型安全的查询方式，是一种 JPQL 的替代方案。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 获取PO</span>
<span class="token class-name">CriteriaBuilder</span> builder <span class="token operator">=</span> entityManager<span class="token punctuation">.</span><span class="token function">getCriteriaBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">CriteriaQuery</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">&gt;</span></span> criteria <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">createQuery</span><span class="token punctuation">(</span> <span class="token class-name">Person</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Root</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">&gt;</span></span> root <span class="token operator">=</span> criteria<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span> <span class="token class-name">Person</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
criteria<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span> root <span class="token punctuation">)</span><span class="token punctuation">;</span>
criteria<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span> builder<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span> root<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span> <span class="token class-name">Person_</span><span class="token punctuation">.</span>name <span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;John Doe&quot;</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">&gt;</span></span> persons <span class="token operator">=</span> entityManager<span class="token punctuation">.</span><span class="token function">createQuery</span><span class="token punctuation">(</span> criteria <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResultList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 获取PO的属性</span>
<span class="token class-name">CriteriaBuilder</span> builder <span class="token operator">=</span> entityManager<span class="token punctuation">.</span><span class="token function">getCriteriaBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">CriteriaQuery</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> criteria <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">createQuery</span><span class="token punctuation">(</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Root</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">&gt;</span></span> root <span class="token operator">=</span> criteria<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span> <span class="token class-name">Person</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
criteria<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span> root<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span> <span class="token class-name">Person_</span><span class="token punctuation">.</span>nickName <span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
criteria<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span> builder<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span> root<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span> <span class="token class-name">Person_</span><span class="token punctuation">.</span>name <span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;John Doe&quot;</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> nickNames <span class="token operator">=</span> entityManager<span class="token punctuation">.</span><span class="token function">createQuery</span><span class="token punctuation">(</span> criteria <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResultList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 获取多个值</span>
<span class="token class-name">CriteriaBuilder</span> builder <span class="token operator">=</span> entityManager<span class="token punctuation">.</span><span class="token function">getCriteriaBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">CriteriaQuery</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Tuple</span><span class="token punctuation">&gt;</span></span> criteria <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">createQuery</span><span class="token punctuation">(</span> <span class="token class-name">Tuple</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Root</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">&gt;</span></span> root <span class="token operator">=</span> criteria<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span> <span class="token class-name">Person</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Path</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> idPath <span class="token operator">=</span> root<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span> <span class="token class-name">Person_</span><span class="token punctuation">.</span>id <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Path</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> nickNamePath <span class="token operator">=</span> root<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span> <span class="token class-name">Person_</span><span class="token punctuation">.</span>nickName<span class="token punctuation">)</span><span class="token punctuation">;</span>
criteria<span class="token punctuation">.</span><span class="token function">multiselect</span><span class="token punctuation">(</span> idPath<span class="token punctuation">,</span> nickNamePath <span class="token punctuation">)</span><span class="token punctuation">;</span>
criteria<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span> builder<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span> root<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span> <span class="token class-name">Person_</span><span class="token punctuation">.</span>name <span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;John Doe&quot;</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Tuple</span><span class="token punctuation">&gt;</span></span> tuples <span class="token operator">=</span> entityManager<span class="token punctuation">.</span><span class="token function">createQuery</span><span class="token punctuation">(</span> criteria <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResultList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span> <span class="token class-name">Tuple</span> tuple <span class="token operator">:</span> tuples <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Long</span> id <span class="token operator">=</span> tuple<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span> idPath <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> nickName <span class="token operator">=</span> tuple<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span> nickNamePath <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 多root</span>
<span class="token class-name">CriteriaBuilder</span> builder <span class="token operator">=</span> entityManager<span class="token punctuation">.</span><span class="token function">getCriteriaBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">CriteriaQuery</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Tuple</span><span class="token punctuation">&gt;</span></span> criteria <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">createQuery</span><span class="token punctuation">(</span> <span class="token class-name">Tuple</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Root</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">&gt;</span></span> personRoot <span class="token operator">=</span> criteria<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span> <span class="token class-name">Person</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Root</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Partner</span><span class="token punctuation">&gt;</span></span> partnerRoot <span class="token operator">=</span> criteria<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span> <span class="token class-name">Partner</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
criteria<span class="token punctuation">.</span><span class="token function">multiselect</span><span class="token punctuation">(</span> personRoot<span class="token punctuation">,</span> partnerRoot <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Predicate</span> personRestriction <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span>
    builder<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span> personRoot<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span> <span class="token class-name">Person_</span><span class="token punctuation">.</span>address <span class="token punctuation">)</span><span class="token punctuation">,</span> address <span class="token punctuation">)</span><span class="token punctuation">,</span>
    builder<span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span> personRoot<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span> <span class="token class-name">Person_</span><span class="token punctuation">.</span>phones <span class="token punctuation">)</span> <span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Predicate</span> partnerRestriction <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span>
    builder<span class="token punctuation">.</span><span class="token function">like</span><span class="token punctuation">(</span> partnerRoot<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span> <span class="token class-name">Partner_</span><span class="token punctuation">.</span>name <span class="token punctuation">)</span><span class="token punctuation">,</span> prefix <span class="token punctuation">)</span><span class="token punctuation">,</span>
    builder<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span> partnerRoot<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span> <span class="token class-name">Partner_</span><span class="token punctuation">.</span>version <span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
criteria<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span> builder<span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span> personRestriction<span class="token punctuation">,</span> partnerRestriction <span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Tuple</span><span class="token punctuation">&gt;</span></span> tuples <span class="token operator">=</span> entityManager<span class="token punctuation">.</span><span class="token function">createQuery</span><span class="token punctuation">(</span> criteria <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResultList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// join</span>
<span class="token class-name">CriteriaBuilder</span> builder <span class="token operator">=</span> entityManager<span class="token punctuation">.</span><span class="token function">getCriteriaBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">CriteriaQuery</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Phone</span><span class="token punctuation">&gt;</span></span> criteria <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">createQuery</span><span class="token punctuation">(</span> <span class="token class-name">Phone</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Root</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Phone</span><span class="token punctuation">&gt;</span></span> root <span class="token operator">=</span> criteria<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span> <span class="token class-name">Phone</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Phone.person is a @ManyToOne</span>
<span class="token class-name">Join</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Phone</span><span class="token punctuation">,</span> <span class="token class-name">Person</span><span class="token punctuation">&gt;</span></span> personJoin <span class="token operator">=</span> root<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span> <span class="token class-name">Phone_</span><span class="token punctuation">.</span>person <span class="token punctuation">)</span><span class="token punctuation">;</span>
criteria<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span>
    builder<span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span>
        builder<span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">Phone_</span><span class="token punctuation">.</span>calls<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        builder<span class="token punctuation">.</span><span class="token function">gt</span><span class="token punctuation">(</span>personJoin<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">Person_</span><span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Phone</span><span class="token punctuation">&gt;</span></span> phones <span class="token operator">=</span> entityManager<span class="token punctuation">.</span><span class="token function">createQuery</span><span class="token punctuation">(</span> criteria <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResultList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="锁"><a href="#锁" class="header-anchor">#</a> 锁</h3> <div class="language-java extra-class"><pre class="language-java"><code>entityManager<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token class-name">Person</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> id<span class="token punctuation">,</span> <span class="token class-name">LockModeType</span><span class="token punctuation">.</span>PESSIMISTIC_WRITE<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">&gt;</span></span> persons <span class="token operator">=</span> 
    entityManager<span class="token punctuation">.</span><span class="token function">createQuery</span><span class="token punctuation">(</span><span class="token string">&quot;select DISTINCT p from Person p&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Person</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setLockMode</span><span class="token punctuation">(</span> <span class="token class-name">LockModeType</span><span class="token punctuation">.</span>PESSIMISTIC_WRITE <span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">getResultList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="事务"><a href="#事务" class="header-anchor">#</a> 事务</h3> <div class="language-java extra-class"><pre class="language-java"><code>entityManager<span class="token punctuation">.</span><span class="token function">getTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
entityManager<span class="token punctuation">.</span><span class="token function">getTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
entityManager<span class="token punctuation">.</span><span class="token function">getTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">rollback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div></div><div class="box"><div class="post-tags"><span class="post-tag ca-tag"><span><a class="firstca" style="color: white">程序设计</a><span><svg aria-hidden="true" focusable="false" data-prefix="fa" data-icon="caret-right" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 192 512" class="svg-inline--fa fa-caret-right fa-w-6" style="width:1rem;"><path fill="currentColor" d="M0 384.662V127.338c0-17.818 21.543-26.741 34.142-14.142l128.662 128.662c7.81 7.81 7.81 20.474 0 28.284L34.142 398.804C21.543 411.404 0 402.48 0 384.662z"></path></svg></span></span><span><a class="endcd" style="color: white">Java</a><!----></span></span><a class="ta-tag post-tag">jpa</a><a class="ta-tag post-tag">java</a><a class="ta-tag post-tag">hibernate</a><span class="da-tag post-tag">2020.08.29</span><!----></div></div><div class="box"><div id="vcomments"></div></div></div></div></div></div></main><div id="top-btn" class="btn" style="display:none;"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="arrow-up" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="svg-inline--fa fa-arrow-up fa-w-14 fa-lg"><path fill="currentColor" d="M34.9 289.5l-22.2-22.2c-9.4-9.4-9.4-24.6 0-33.9L207 39c9.4-9.4 24.6-9.4 33.9 0l194.3 194.3c9.4 9.4 9.4 24.6 0 33.9L413 289.4c-9.5 9.5-25 9.3-34.3-.4L264 168.6V456c0 13.3-10.7 24-24 24h-32c-13.3 0-24-10.7-24-24V168.6L69.2 289.1c-9.3 9.8-24.8 10-34.3.4z"></path></svg></div></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.2d05b873.js" defer></script><script src="/assets/js/9.fd2d7f08.js" defer></script><script src="/assets/js/3.5fc63a44.js" defer></script><script src="/assets/js/15.0b8b74f4.js" defer></script>
  </body>
</html>
