<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Spring 学习笔记 | sunn4room</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="icon" href="/favicon.png">
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.62005803.css" as="style"><link rel="preload" href="/assets/js/app.2d05b873.js" as="script"><link rel="preload" href="/assets/js/9.fd2d7f08.js" as="script"><link rel="preload" href="/assets/js/3.5fc63a44.js" as="script"><link rel="preload" href="/assets/js/10.50ae4a69.js" as="script"><link rel="prefetch" href="/assets/js/11.afdccb1f.js"><link rel="prefetch" href="/assets/js/12.0010c894.js"><link rel="prefetch" href="/assets/js/13.eb55877c.js"><link rel="prefetch" href="/assets/js/14.65cfc2ff.js"><link rel="prefetch" href="/assets/js/15.0b8b74f4.js"><link rel="prefetch" href="/assets/js/16.4dbb4aa4.js"><link rel="prefetch" href="/assets/js/17.271c05bb.js"><link rel="prefetch" href="/assets/js/18.4c3e94d0.js"><link rel="prefetch" href="/assets/js/19.1a0cddca.js"><link rel="prefetch" href="/assets/js/2.d45a9055.js"><link rel="prefetch" href="/assets/js/20.cdf7cb28.js"><link rel="prefetch" href="/assets/js/21.fbf2cd3f.js"><link rel="prefetch" href="/assets/js/22.42257d5f.js"><link rel="prefetch" href="/assets/js/23.e26a383f.js"><link rel="prefetch" href="/assets/js/24.d9c833cd.js"><link rel="prefetch" href="/assets/js/25.f8ca341b.js"><link rel="prefetch" href="/assets/js/26.a42edc25.js"><link rel="prefetch" href="/assets/js/27.0127ab0c.js"><link rel="prefetch" href="/assets/js/28.cd79c0d4.js"><link rel="prefetch" href="/assets/js/29.c3f37782.js"><link rel="prefetch" href="/assets/js/30.043d284c.js"><link rel="prefetch" href="/assets/js/31.423ed3ce.js"><link rel="prefetch" href="/assets/js/32.26519eb1.js"><link rel="prefetch" href="/assets/js/33.f57167ad.js"><link rel="prefetch" href="/assets/js/34.ecaa6ee5.js"><link rel="prefetch" href="/assets/js/35.47e91ee0.js"><link rel="prefetch" href="/assets/js/36.258a624f.js"><link rel="prefetch" href="/assets/js/37.68bb6fda.js"><link rel="prefetch" href="/assets/js/38.94239711.js"><link rel="prefetch" href="/assets/js/39.e83c38cf.js"><link rel="prefetch" href="/assets/js/4.caf2fcbd.js"><link rel="prefetch" href="/assets/js/40.acf21eb1.js"><link rel="prefetch" href="/assets/js/41.d164530a.js"><link rel="prefetch" href="/assets/js/5.886701df.js"><link rel="prefetch" href="/assets/js/6.61d8e906.js"><link rel="prefetch" href="/assets/js/7.177acf7a.js"><link rel="prefetch" href="/assets/js/8.84396220.js">
    <link rel="stylesheet" href="/assets/css/0.styles.62005803.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="app"><div id="header"><img id="hero" src="/assets/img/hero.470debc7.png"><span id="title">Spring 学习笔记</span><div id="search-box" class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div><aside id="aside"><div class="__vuescroll" style="height:100%;width:100%;padding:0;position:relative;overflow:hidden;"><div class="__panel __hidebar" style="position:relative;box-sizing:border-box;height:100%;overflow-y:hidden;overflow-x:hidden;transform-origin:;transform:;"><div class="__view" style="position:relative;box-sizing:border-box;min-width:100%;min-height:100%;"><div class="margin-box"><div class="white-line"></div><div class="shell"><div class="sh-header"><div class="dot" style="background-color: #e9524a"></div><div class="dot" style="background-color: #f1ae1b"></div><div class="dot" style="background-color: #59c837"></div></div><div class="sh-body"><div class="line"><span>&gt; </span><span style="color:#4ebdcf">Who are you?</span></div><div class="line right"><span style="color:#97d209">I'm sunn4room</span><span> &lt;</span></div><div class="line right"><span style="color:#97d209">em... Just Sunny Room</span><span> &lt;</span></div><div class="line right"><span style="color:#97d209">And you?</span><span class="cursor">a</span><span> &lt;</span></div></div></div><div class="header-tag" style="font-size:1rem;font-weight:bold;margin-top:1.5rem;">Spring 学习笔记</div><a href="#spring-容器" class="header-tag" style="font-size:1rem;margin-left:1rem;">Spring 容器</a><a href="#容器组件" class="header-tag" style="font-size:1rem;margin-left:2rem;">容器组件</a><a href="#beanfactory" class="header-tag" style="font-size:1rem;margin-left:3rem;">BeanFactory</a><a href="#applicationcontext" class="header-tag" style="font-size:1rem;margin-left:3rem;">ApplicationContext</a><a href="#resource" class="header-tag" style="font-size:1rem;margin-left:3rem;">Resource</a><a href="#beandefination" class="header-tag" style="font-size:1rem;margin-left:3rem;">BeanDefination</a><a href="#容器配置-注解" class="header-tag" style="font-size:1rem;margin-left:2rem;">容器配置（注解）</a><a href="#profile" class="header-tag" style="font-size:1rem;margin-left:3rem;">@Profile</a><a href="#configuration" class="header-tag" style="font-size:1rem;margin-left:3rem;">@Configuration</a><a href="#import" class="header-tag" style="font-size:1rem;margin-left:3rem;">@Import</a><a href="#bean" class="header-tag" style="font-size:1rem;margin-left:3rem;">@Bean</a><a href="#componentscan" class="header-tag" style="font-size:1rem;margin-left:3rem;">@ComponentScan</a><a href="#component" class="header-tag" style="font-size:1rem;margin-left:3rem;">@Component</a><a href="#scope" class="header-tag" style="font-size:1rem;margin-left:3rem;">@Scope</a><a href="#lookup" class="header-tag" style="font-size:1rem;margin-left:4rem;">@Lookup</a><a href="#lazy" class="header-tag" style="font-size:1rem;margin-left:3rem;">@Lazy</a><a href="#postconstruct" class="header-tag" style="font-size:1rem;margin-left:3rem;">@PostConstruct</a><a href="#predestroy" class="header-tag" style="font-size:1rem;margin-left:3rem;">@PreDestroy</a><a href="#dependson" class="header-tag" style="font-size:1rem;margin-left:3rem;">@DependsOn</a><a href="#容器生命周期" class="header-tag" style="font-size:1rem;margin-left:2rem;">容器生命周期</a><a href="#容器事件与监听器" class="header-tag" style="font-size:1rem;margin-left:2rem;">容器事件与监听器</a><a href="#控制反转" class="header-tag" style="font-size:1rem;margin-left:1rem;">控制反转</a><a href="#autowired" class="header-tag" style="font-size:1rem;margin-left:2rem;">@Autowired</a><a href="#primary" class="header-tag" style="font-size:1rem;margin-left:3rem;">@Primary</a><a href="#qualifier" class="header-tag" style="font-size:1rem;margin-left:3rem;">@Qualifier</a><a href="#resource-2" class="header-tag" style="font-size:1rem;margin-left:2rem;">@Resource</a><a href="#value" class="header-tag" style="font-size:1rem;margin-left:2rem;">@Value</a><a href="#configurationproperties" class="header-tag" style="font-size:1rem;margin-left:3rem;">＠ConfigurationProperties</a><a href="#nestedconfigurationproperty" class="header-tag" style="font-size:1rem;margin-left:4rem;">@NestedConfigurationProperty</a><a href="#enableconfigurationproperties" class="header-tag" style="font-size:1rem;margin-left:4rem;">@EnableConfigurationProperties</a><a href="#propertysource" class="header-tag" style="font-size:1rem;margin-left:3rem;">@PropertySource</a><a href="#objectprovider" class="header-tag" style="font-size:1rem;margin-left:2rem;">ObjectProvider</a><a href="#数据管理" class="header-tag" style="font-size:1rem;margin-left:1rem;">数据管理</a><a href="#面向切面" class="header-tag" style="font-size:1rem;margin-left:1rem;">面向切面</a><a href="#aop-架构" class="header-tag" style="font-size:1rem;margin-left:2rem;">AOP 架构</a><a href="#advice" class="header-tag" style="font-size:1rem;margin-left:3rem;">Advice</a><a href="#pointcut" class="header-tag" style="font-size:1rem;margin-left:3rem;">Pointcut</a><a href="#advisor" class="header-tag" style="font-size:1rem;margin-left:3rem;">Advisor</a><a href="#proxyfactory" class="header-tag" style="font-size:1rem;margin-left:3rem;">ProxyFactory</a><a href="#proxyfactorybean" class="header-tag" style="font-size:1rem;margin-left:3rem;">ProxyFactoryBean</a><a href="#abstractautoproxycreator" class="header-tag" style="font-size:1rem;margin-left:3rem;">AbstractAutoProxyCreator</a><a href="#开启-aspectj-支持" class="header-tag" style="font-size:1rem;margin-left:2rem;">开启 AspectJ 支持</a><a href="#声明-aspect-类" class="header-tag" style="font-size:1rem;margin-left:2rem;">声明 Aspect 类</a><a href="#声明-point-cut" class="header-tag" style="font-size:1rem;margin-left:2rem;">声明 Point Cut</a><a href="#execution" class="header-tag" style="font-size:1rem;margin-left:3rem;">execution</a><a href="#within" class="header-tag" style="font-size:1rem;margin-left:3rem;">within</a><a href="#within-2" class="header-tag" style="font-size:1rem;margin-left:3rem;">@within</a><a href="#target" class="header-tag" style="font-size:1rem;margin-left:3rem;">target</a><a href="#target-2" class="header-tag" style="font-size:1rem;margin-left:3rem;">@target</a><a href="#this" class="header-tag" style="font-size:1rem;margin-left:3rem;">this</a><a href="#args" class="header-tag" style="font-size:1rem;margin-left:3rem;">args</a><a href="#args-2" class="header-tag" style="font-size:1rem;margin-left:3rem;">@args</a><a href="#annotation" class="header-tag" style="font-size:1rem;margin-left:3rem;">@annotation</a><a href="#bean-2" class="header-tag" style="font-size:1rem;margin-left:3rem;">bean</a><a href="#逻辑组合" class="header-tag" style="font-size:1rem;margin-left:3rem;">逻辑组合</a><a href="#声明-advice" class="header-tag" style="font-size:1rem;margin-left:2rem;">声明 Advice</a><a href="#joinpoint-接口" class="header-tag" style="font-size:1rem;margin-left:3rem;">JoinPoint  接口</a><a href="#proceedingjoinpoint-接口" class="header-tag" style="font-size:1rem;margin-left:4rem;">ProceedingJoinPoint 接口</a><a href="#before" class="header-tag" style="font-size:1rem;margin-left:3rem;">before</a><a href="#after-returning" class="header-tag" style="font-size:1rem;margin-left:3rem;">after returning</a><a href="#after-throwing" class="header-tag" style="font-size:1rem;margin-left:3rem;">after throwing</a><a href="#after-finally" class="header-tag" style="font-size:1rem;margin-left:3rem;">after finally</a><a href="#around" class="header-tag" style="font-size:1rem;margin-left:3rem;">around</a><a href="#类型描述在-advice-中的特殊用途" class="header-tag" style="font-size:1rem;margin-left:3rem;">类型描述在 Advice 中的特殊用途</a><a href="#introduction-新接口" class="header-tag endtag" style="font-size:1rem;margin-left:2rem;">Introduction 新接口</a></div></div></div></div></aside><div id="curtain"></div><main id="main"><div class="__vuescroll" style="height:100%;width:100%;padding:0;position:relative;overflow:hidden;"><div class="__panel __hidebar" style="position:relative;box-sizing:border-box;height:100%;overflow-y:hidden;overflow-x:hidden;transform-origin:;transform:;"><div class="__view" style="position:relative;box-sizing:border-box;min-width:100%;min-height:100%;"><div class="margin-box"><div class="white-line"></div><div class="box"><div class="post-tags"><span class="post-tag ca-tag"><span><a class="firstca" style="color: white">程序设计</a><span><svg aria-hidden="true" focusable="false" data-prefix="fa" data-icon="caret-right" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 192 512" class="svg-inline--fa fa-caret-right fa-w-6" style="width:1rem;"><path fill="currentColor" d="M0 384.662V127.338c0-17.818 21.543-26.741 34.142-14.142l128.662 128.662c7.81 7.81 7.81 20.474 0 28.284L34.142 398.804C21.543 411.404 0 402.48 0 384.662z"></path></svg></span></span><span><a class="endcd" style="color: white">Java</a><!----></span></span><a class="ta-tag post-tag">学习笔记</a><a class="ta-tag post-tag">spring</a><a class="ta-tag post-tag">java</a><a class="ta-tag post-tag">DI</a><a class="ta-tag post-tag">AOP</a><span class="da-tag post-tag">2020.08.02</span><!----></div></div><div class="box"><h1 style="text-align:center;">Spring 学习笔记</h1><div class="markdown-body content__default"><h1 id="spring-学习笔记"><a href="#spring-学习笔记" class="header-anchor">#</a> Spring 学习笔记</h1> <p>Spring是一个轻量级控制反转(IoC)和面向切面(AOP)的容器框架，并由此衍生出了一个庞大的生态体系。</p> <h2 id="spring-容器"><a href="#spring-容器" class="header-anchor">#</a> Spring 容器</h2> <h3 id="容器组件"><a href="#容器组件" class="header-anchor">#</a> 容器组件</h3> <p><img src="/assets/img/container.b9f3b73e.svg" alt=""></p> <h4 id="beanfactory"><a href="#beanfactory" class="header-anchor">#</a> BeanFactory</h4> <p>提供了高级配置机制来管理任何类型的容器内对象</p> <p><img src="/assets/img/beanfactory.7121ac00.svg" alt=""></p> <h4 id="applicationcontext"><a href="#applicationcontext" class="header-anchor">#</a> ApplicationContext</h4> <p>这就是 Spring 容器的标准接口，在 BeanFactory 的基础上，添加了一下主要特性：</p> <ul><li>自动实例化 Singleton</li> <li>自动注册各种后处理器</li> <li>国际化</li> <li>容器内事件发布</li> <li>配置资源管理</li> <li>容器生命周期管理</li></ul> <p><img src="/assets/img/applicationcontext.b61b1b34.svg" alt=""></p> <h4 id="resource"><a href="#resource" class="header-anchor">#</a> Resource</h4> <p>Spring 容器支持两种资源配置形式：</p> <ul><li>XML-based Config</li> <li>Java-based Config（我只关注这种形式）</li></ul> <blockquote><p>Spring 还支持另一种独特的配置形式，那就是 Annotation 注解，即将配置信息放到源代码中存放，从而降低了 XML-based 和 Java-based 里的复杂度</p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@Import</span><span class="token punctuation">(</span><span class="token string">&quot;xxx.xxx.XxxConfig&quot;</span><span class="token punctuation">)</span> <span class="token comment">//引入其他配置类</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">XxxConfig</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="beandefination"><a href="#beandefination" class="header-anchor">#</a> BeanDefination</h4> <p>包含了一下主要信息：</p> <ul><li>类型信息</li> <li>行为信息</li> <li>依赖信息</li> <li>属性信息</li></ul> <p>ClassPathScanningCandidateComponentProvider</p> <p>ClassPathBeanDefinitionScanner</p> <h3 id="容器配置-注解"><a href="#容器配置-注解" class="header-anchor">#</a> 容器配置（注解）</h3> <h4 id="profile"><a href="#profile" class="header-anchor">#</a> @Profile</h4> <p>标识应用不同的环境。外部使用时可以激活一个或多个 profile 标识</p> <h4 id="configuration"><a href="#configuration" class="header-anchor">#</a> @Configuration</h4> <p>声明为一个 Java-based Config</p> <h4 id="import"><a href="#import" class="header-anchor">#</a> @Import</h4> <p>引入外部 Bean 配置</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Import</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token class-name">Xxx</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">Xxx</span><span class="token punctuation">,</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 普通的配置类或组件类</span>
<span class="token comment">// ImportSelector 的实现类，根据注解元数据返回全限定类名的字符串数组，这些类可以是普通的配置类或组件类</span>
<span class="token comment">// ImportBeanDefinitionRegistrar 的实现类，根据注解元数据注册 BeanDefinition</span>
</code></pre></div><h4 id="bean"><a href="#bean" class="header-anchor">#</a> @Bean</h4> <p>被修饰方法的返回值会被当做一个 bean</p> <h4 id="componentscan"><a href="#componentscan" class="header-anchor">#</a> @ComponentScan</h4> <p>和 @Component 配合完成 bean 的扫描添加</p> <h4 id="component"><a href="#component" class="header-anchor">#</a> @Component</h4> <p>和 @ComponentScan 配合完成 bean 的扫描添加，类似的注解还有：@Controller（Prototype）、@Service、@Repository</p> <h4 id="scope"><a href="#scope" class="header-anchor">#</a> @Scope</h4> <table><thead><tr><th>类型</th> <th>描述</th> <th>适用场景</th></tr></thead> <tbody><tr><td>singleton</td> <td>会被添加到容器缓存中，每次请求Bean时都返回同一个实例</td> <td>无状态 Bean</td></tr> <tr><td>prototype</td> <td>不会被添加到容器缓存中，每次请求Bean时都会新建一个实例出来。</td> <td>有状态 Bean</td></tr></tbody></table> <h5 id="lookup"><a href="#lookup" class="header-anchor">#</a> @Lookup</h5> <p>当 singleton bean 依赖一个 prototype bean 时，prototype 的性质就被破坏了，解决方案如下：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// singleton class define</span>
<span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">MySingleton</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Lookup</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token class-name">MyPrototype</span> <span class="token function">myPrototype</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ... 调用 myPrototype 方法获取 prototype 性质的 bean</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="lazy"><a href="#lazy" class="header-anchor">#</a> @Lazy</h4> <p>如果不希望容器初始化之后立即初始化指定 singleton bean ，可以设置延迟加载行为</p> <h4 id="postconstruct"><a href="#postconstruct" class="header-anchor">#</a> @PostConstruct</h4> <p>指定 bean 实例化之后的行为方法</p> <h4 id="predestroy"><a href="#predestroy" class="header-anchor">#</a> @PreDestroy</h4> <p>指定 bean 实例销毁之前的行为方法</p> <h4 id="dependson"><a href="#dependson" class="header-anchor">#</a> @DependsOn</h4> <p>在初始化当前 bean 之前初始化指定的 bean</p> <h3 id="容器生命周期"><a href="#容器生命周期" class="header-anchor">#</a> 容器生命周期</h3> <p>spring 容器相当于一个复杂的工厂，这个工厂可以输入任何一个 POJO，容器中称为 Bean，并有效处理 Bean 之间的耦合后输出。</p> <p>而其中的一道道处理工序是由一些 Spring Bean 负责完成的，也就是说，Spring 自身面向处理流程规定了一系列的接口，要想参与到 Spring 的处理流程中，就必须实现响应的接口，并被 Spring 识别生效。</p> <p>想要认识到这些接口就必须了解容器的整个生命周期是怎样的，如图：</p> <ul><li>BeanDefinitionRegistryPostProcessor's <strong>postProcessBeanDefinitionRegistry</strong></li> <li>BeanFactoryPostProcessor's <strong>postProcessBeanFactory</strong></li> <li>InstantiationAwareBeanPostProcessor's <strong>postProcessBeforeInstantiation</strong></li> <li>SmartInstantiationAwareBeanPostProcessor's <strong>determineCandidateConstructors</strong></li> <li>MergedBeanDefinitionPostProcessor's <strong>postProcessMergedBeanDefinition</strong></li> <li>SmartInstantiationAwareBeanPostProcessor's <strong>getEarlyBeanReference</strong></li> <li>InstantiationAwareBeanPostProcessor's <strong>postProcessAfterInstantiation</strong></li> <li>InstantiationAwareBeanPostProcessor's <strong>postProcessPropertyValues</strong></li> <li>BeanNameAware、BeanClassLoaderAware、BeanFactoryAware、EnvironmentAware、EmbeddedValueResolverAware、ResourceLoaderAware、ApplicationEventPublisherAware、MessageSourceAware、ApplicationContextAware、ServletContextAware's <strong>setXxx</strong></li> <li>BeanPostProcessor's <strong>postProcessBeforeInitialization</strong></li> <li>InitializingBean's <strong>afterPropertiesSet</strong></li> <li>BeanPostProcessor's <strong>postProcessAfterInitialization</strong></li> <li>FactoryBean's <strong>getObject</strong></li> <li>DestructionAwareBeanPostProcessors's <strong>postProcessBeforeDestruction</strong></li> <li>DisposableBean's <strong>destroy</strong></li></ul> <h3 id="容器事件与监听器"><a href="#容器事件与监听器" class="header-anchor">#</a> 容器事件与监听器</h3> <h2 id="控制反转"><a href="#控制反转" class="header-anchor">#</a> 控制反转</h2> <p>Inversion of Control (IoC) 是 bean 的依赖关系的控制不再需要额外代码维护，而是交给 Spring 容器全权负责。</p> <h3 id="autowired"><a href="#autowired" class="header-anchor">#</a> @Autowired</h3> <div class="language- extra-class"><pre class="language-text"><code>采用byType自动注入,由Spring提供,需要导入org.springframework.beans.factory.annotation.Autowired
默认情况要求对象必须存在,如果需要为null,可以设置它的required=true
如果接口存在多个实现类,我们依然可以byName自动注入:通过与@Qualifier搭配使用
即先byType,byType匹配到多个时,再通过byName
</code></pre></div><h4 id="primary"><a href="#primary" class="header-anchor">#</a> @Primary</h4> <h4 id="qualifier"><a href="#qualifier" class="header-anchor">#</a> @Qualifier</h4> <h3 id="resource-2"><a href="#resource-2" class="header-anchor">#</a> @Resource</h3> <div class="language- extra-class"><pre class="language-text"><code>默认按照byName自动注入,由J2EE提供,需要导入javax.annotation.Resource
它有两个重要的属性name和type,而Spring将@Resource注解的name属性解析为bean的名字,而type属性则解析为bean的类型
所以,如果使用name属性,则使用byName的自动注入策略,而使用type属性时则使用byType自动注入策略
如果name和type属性都未指定,则默认byName注入,byName未找到时,会继续采用byType注入
</code></pre></div><h3 id="value"><a href="#value" class="header-anchor">#</a> @Value</h3> <h4 id="configurationproperties"><a href="#configurationproperties" class="header-anchor">#</a> ＠ConfigurationProperties</h4> <h5 id="nestedconfigurationproperty"><a href="#nestedconfigurationproperty" class="header-anchor">#</a> @NestedConfigurationProperty</h5> <h5 id="enableconfigurationproperties"><a href="#enableconfigurationproperties" class="header-anchor">#</a> @EnableConfigurationProperties</h5> <h4 id="propertysource"><a href="#propertysource" class="header-anchor">#</a> @PropertySource</h4> <h3 id="objectprovider"><a href="#objectprovider" class="header-anchor">#</a> ObjectProvider</h3> <p>半自动依赖注入，过程中提供了类型检查，比如唯一性检查、存在性检查等</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FooService</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Xxx</span> xx<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">FooService</span><span class="token punctuation">(</span><span class="token class-name">ObjectProvider</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Xxx</span><span class="token punctuation">&gt;</span></span> repositoryProvider<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>xxx <span class="token operator">=</span> repositoryProvider<span class="token punctuation">.</span><span class="token function">getIfUnique</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="数据管理"><a href="#数据管理" class="header-anchor">#</a> 数据管理</h2> <h2 id="面向切面"><a href="#面向切面" class="header-anchor">#</a> 面向切面</h2> <p>Aspect-oriented Programming （AOP）是对 Object-oriented Programming （OOP）的补充，使得不同类型的对象也可以通过某种规范联系起来一起拓展新功能。</p> <p><img src="/assets/img/aspect.590e3b50.svg" alt=""></p> <ul><li><p>join point：程序执行期间可以被切入的点，通常就是方法的执行</p></li> <li><p>point cut：切入规则，用于筛选 join point</p></li> <li><p>advice：符合 point cut 的 join point 将要被实施的增强处理</p></li> <li><p>aspect：对于 point cut 和 advice 的模块化管理，可看做是一种声明</p></li> <li><p>target object：受 point cut 影响的目标对象</p></li> <li><p>weaving：连接相应的 aspect 到 target object</p></li> <li><p>proxy：完成 weaving 后创建出来的代理对象</p></li></ul> <h3 id="aop-架构"><a href="#aop-架构" class="header-anchor">#</a> AOP 架构</h3> <p>Spring AOP 借用了 AspectJ 的语法，但是织入过程是自己实现的。</p> <h4 id="advice"><a href="#advice" class="header-anchor">#</a> Advice</h4> <p><img src="/assets/img/advice.88dead87.svg" alt="advice"></p> <p>Spring AOP 只支持方法调用增强和引入增强</p> <h4 id="pointcut"><a href="#pointcut" class="header-anchor">#</a> Pointcut</h4> <p><img src="/assets/img/pointcut.8047ddc9.svg" alt="pointcut"></p> <h4 id="advisor"><a href="#advisor" class="header-anchor">#</a> Advisor</h4> <p><img src="/assets/img/advisor.f7bac45e.svg" alt="advisor"></p> <h4 id="proxyfactory"><a href="#proxyfactory" class="header-anchor">#</a> ProxyFactory</h4> <p>Spring 只支持运行期织入：</p> <ul><li>JDK 动态代理：实现目标对象的接口完成接口方法的代理</li> <li>CGLIB 代理：继承目标对象完成全方法的代理</li></ul> <h4 id="proxyfactorybean"><a href="#proxyfactorybean" class="header-anchor">#</a> ProxyFactoryBean</h4> <h4 id="abstractautoproxycreator"><a href="#abstractautoproxycreator" class="header-anchor">#</a> AbstractAutoProxyCreator</h4> <p><img src="/assets/img/proxycreator.aff8e6de.svg" alt="proxycreator"></p> <h3 id="开启-aspectj-支持"><a href="#开启-aspectj-支持" class="header-anchor">#</a> 开启 AspectJ 支持</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@EnableAspectJAutoProxy</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AppConfig</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
</code></pre></div><blockquote><p>@EnableAspectJAutoProxy 的两个属性含义</p> <ul><li>proxyTargetClass：是否强制使用 CGLIB</li> <li>exposeProxy：是否暴露代理对象到 AopContext，如果是的话，可以在内部通过 AopContext.currentProxy() 访问到当前的代理对象，一般应用在代理方法嵌套调用的情景中</li></ul></blockquote> <h3 id="声明-aspect-类"><a href="#声明-aspect-类" class="header-anchor">#</a> 声明 Aspect 类</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Aspect</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NotVeryUsefulAspect</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
</code></pre></div><h3 id="声明-point-cut"><a href="#声明-point-cut" class="header-anchor">#</a> 声明 Point Cut</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Pointcut</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;切入点表达式&gt;&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token operator">&lt;</span>引用名<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><h4 id="execution"><a href="#execution" class="header-anchor">#</a> execution</h4> <p>方法描述</p> <div class="language- extra-class"><pre class="language-text"><code>execution([&lt;方法修饰符&gt;] &lt;返回值类型&gt; [&lt;宿主类&gt;.]&lt;方法名&gt;(&lt;形参类型列表&gt;) [&lt;抛出的异常&gt;])
</code></pre></div><blockquote><ul><li><code>*</code> 匹配单个无间隔符序列</li> <li><code>..</code> 匹配零个和多个无间隔符序列并用间隔符连接起来</li> <li><code>+</code> 匹配指定类型的子类型；仅能作为后缀放在类型模式后边</li></ul></blockquote> <h4 id="within"><a href="#within" class="header-anchor">#</a> within</h4> <p>无继承关系的类型描述</p> <div class="language- extra-class"><pre class="language-text"><code>within(&lt;包名&gt;.&lt;类名&gt;)
</code></pre></div><h4 id="within-2"><a href="#within-2" class="header-anchor">#</a> @within</h4> <p>对含有指定注解的当前类的独占方法有效，通过子类对象调用到当前类对象的方法时也有效</p> <h4 id="target"><a href="#target" class="header-anchor">#</a> target</h4> <p>有继承关系的类型描述</p> <h4 id="target-2"><a href="#target-2" class="header-anchor">#</a> @target</h4> <p>对含有指定注解的当前类的所有可用方法有效，包括继承来的</p> <h4 id="this"><a href="#this" class="header-anchor">#</a> this</h4> <p>JDK 动态代理：目标对象的接口的有继承关系的类型描述</p> <p>CGLIB 代理：同 target</p> <h4 id="args"><a href="#args" class="header-anchor">#</a> args</h4> <p>参数的有继承关系的类型描述</p> <h4 id="args-2"><a href="#args-2" class="header-anchor">#</a> @args</h4> <p>当方法的参数的类型上还有指定的注解时有效</p> <h4 id="annotation"><a href="#annotation" class="header-anchor">#</a> @annotation</h4> <p>方法上还有指定注解时有效</p> <h4 id="bean-2"><a href="#bean-2" class="header-anchor">#</a> bean</h4> <p>对 Spring 容器中的 bean name 的描述</p> <div class="language- extra-class"><pre class="language-text"><code>bean(&lt;bean 名称&gt;)
</code></pre></div><h4 id="逻辑组合"><a href="#逻辑组合" class="header-anchor">#</a> 逻辑组合</h4> <div class="language- extra-class"><pre class="language-text"><code>xxx &amp;&amp; xxx
xxx || xxx
! xxx
</code></pre></div><h3 id="声明-advice"><a href="#声明-advice" class="header-anchor">#</a> 声明 Advice</h3> <h4 id="joinpoint-接口"><a href="#joinpoint-接口" class="header-anchor">#</a> JoinPoint  接口</h4> <ul><li><code>Object[] getArgs()</code>：返回参数列表</li> <li><code>Object getThis()</code>：返回代理对象</li> <li><code>Object getTarget()</code>：返回目标对象</li></ul> <h5 id="proceedingjoinpoint-接口"><a href="#proceedingjoinpoint-接口" class="header-anchor">#</a> ProceedingJoinPoint 接口</h5> <p>继承自 JoinPoint</p> <ul><li><code>Object proceed()</code>：执行</li></ul> <h4 id="before"><a href="#before" class="header-anchor">#</a> before</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Before</span><span class="token punctuation">(</span><span class="token string">&quot;xxx&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token class-name">JoinPoint</span> jp<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
</code></pre></div><h4 id="after-returning"><a href="#after-returning" class="header-anchor">#</a> after returning</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@AfterReturning</span><span class="token punctuation">(</span><span class="token punctuation">[</span>pointcut<span class="token operator">=</span><span class="token string">&quot;xxx&quot;</span><span class="token punctuation">,</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>returning<span class="token operator">=</span><span class="token string">&quot;r&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token class-name">JoinPoint</span> jp<span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token class-name">Xxx</span> r<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
</code></pre></div><h4 id="after-throwing"><a href="#after-throwing" class="header-anchor">#</a> after throwing</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@AfterThrowing</span><span class="token punctuation">(</span><span class="token punctuation">[</span>pointcut<span class="token operator">=</span><span class="token string">&quot;xxx&quot;</span><span class="token punctuation">,</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>throwing<span class="token operator">=</span><span class="token string">&quot;e&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token class-name">JoinPoint</span> jp<span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token class-name">Xxx</span> e<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
</code></pre></div><h4 id="after-finally"><a href="#after-finally" class="header-anchor">#</a> after finally</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@After</span><span class="token punctuation">(</span><span class="token string">&quot;xxx&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token class-name">JoinPoint</span> jp<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
</code></pre></div><h4 id="around"><a href="#around" class="header-anchor">#</a> around</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Around</span><span class="token punctuation">(</span><span class="token string">&quot;xxx&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token class-name">ProceedingJoinPoint</span> pjp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>
    <span class="token comment">// start stopwatch</span>
    <span class="token class-name">Object</span> retVal <span class="token operator">=</span> pjp<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// stop stopwatch</span>
    <span class="token keyword">return</span> retVal<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="类型描述在-advice-中的特殊用途"><a href="#类型描述在-advice-中的特殊用途" class="header-anchor">#</a> 类型描述在 Advice 中的特殊用途</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Before</span><span class="token punctuation">(</span><span class="token string">&quot;args(param)&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>参数类型<span class="token operator">&gt;</span> param<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
</code></pre></div><h3 id="introduction-新接口"><a href="#introduction-新接口" class="header-anchor">#</a> Introduction 新接口</h3> <p>对指定类型的对象引入新的接口增强功能。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@DeclareParents</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token string">&quot;&lt;类型描述&gt;&quot;</span><span class="token punctuation">,</span> defaultImpl<span class="token operator">=</span><span class="token operator">&lt;</span>默认实现<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token operator">&lt;</span>新的增强接口<span class="token operator">&gt;</span> mixin<span class="token punctuation">;</span>
</code></pre></div></div></div><div class="box"><div class="post-tags"><span class="post-tag ca-tag"><span><a class="firstca" style="color: white">程序设计</a><span><svg aria-hidden="true" focusable="false" data-prefix="fa" data-icon="caret-right" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 192 512" class="svg-inline--fa fa-caret-right fa-w-6" style="width:1rem;"><path fill="currentColor" d="M0 384.662V127.338c0-17.818 21.543-26.741 34.142-14.142l128.662 128.662c7.81 7.81 7.81 20.474 0 28.284L34.142 398.804C21.543 411.404 0 402.48 0 384.662z"></path></svg></span></span><span><a class="endcd" style="color: white">Java</a><!----></span></span><a class="ta-tag post-tag">学习笔记</a><a class="ta-tag post-tag">spring</a><a class="ta-tag post-tag">java</a><a class="ta-tag post-tag">DI</a><a class="ta-tag post-tag">AOP</a><span class="da-tag post-tag">2020.08.02</span><!----></div></div><div class="box"><div id="vcomments"></div></div></div></div></div></div></main><div id="top-btn" class="btn" style="display:none;"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="arrow-up" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="svg-inline--fa fa-arrow-up fa-w-14 fa-lg"><path fill="currentColor" d="M34.9 289.5l-22.2-22.2c-9.4-9.4-9.4-24.6 0-33.9L207 39c9.4-9.4 24.6-9.4 33.9 0l194.3 194.3c9.4 9.4 9.4 24.6 0 33.9L413 289.4c-9.5 9.5-25 9.3-34.3-.4L264 168.6V456c0 13.3-10.7 24-24 24h-32c-13.3 0-24-10.7-24-24V168.6L69.2 289.1c-9.3 9.8-24.8 10-34.3.4z"></path></svg></div></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.2d05b873.js" defer></script><script src="/assets/js/9.fd2d7f08.js" defer></script><script src="/assets/js/3.5fc63a44.js" defer></script><script src="/assets/js/10.50ae4a69.js" defer></script>
  </body>
</html>
