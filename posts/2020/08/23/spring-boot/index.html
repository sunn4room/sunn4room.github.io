<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Spring Boot 学习笔记 | sunn4room</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="icon" href="/favicon.png">
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.62005803.css" as="style"><link rel="preload" href="/assets/js/app.2d05b873.js" as="script"><link rel="preload" href="/assets/js/9.fd2d7f08.js" as="script"><link rel="preload" href="/assets/js/3.5fc63a44.js" as="script"><link rel="preload" href="/assets/js/22.42257d5f.js" as="script"><link rel="prefetch" href="/assets/js/10.50ae4a69.js"><link rel="prefetch" href="/assets/js/11.afdccb1f.js"><link rel="prefetch" href="/assets/js/12.0010c894.js"><link rel="prefetch" href="/assets/js/13.eb55877c.js"><link rel="prefetch" href="/assets/js/14.65cfc2ff.js"><link rel="prefetch" href="/assets/js/15.0b8b74f4.js"><link rel="prefetch" href="/assets/js/16.4dbb4aa4.js"><link rel="prefetch" href="/assets/js/17.271c05bb.js"><link rel="prefetch" href="/assets/js/18.4c3e94d0.js"><link rel="prefetch" href="/assets/js/19.1a0cddca.js"><link rel="prefetch" href="/assets/js/2.d45a9055.js"><link rel="prefetch" href="/assets/js/20.cdf7cb28.js"><link rel="prefetch" href="/assets/js/21.fbf2cd3f.js"><link rel="prefetch" href="/assets/js/23.e26a383f.js"><link rel="prefetch" href="/assets/js/24.d9c833cd.js"><link rel="prefetch" href="/assets/js/25.f8ca341b.js"><link rel="prefetch" href="/assets/js/26.a42edc25.js"><link rel="prefetch" href="/assets/js/27.0127ab0c.js"><link rel="prefetch" href="/assets/js/28.cd79c0d4.js"><link rel="prefetch" href="/assets/js/29.c3f37782.js"><link rel="prefetch" href="/assets/js/30.043d284c.js"><link rel="prefetch" href="/assets/js/31.423ed3ce.js"><link rel="prefetch" href="/assets/js/32.26519eb1.js"><link rel="prefetch" href="/assets/js/33.f57167ad.js"><link rel="prefetch" href="/assets/js/34.ecaa6ee5.js"><link rel="prefetch" href="/assets/js/35.47e91ee0.js"><link rel="prefetch" href="/assets/js/36.258a624f.js"><link rel="prefetch" href="/assets/js/37.68bb6fda.js"><link rel="prefetch" href="/assets/js/38.94239711.js"><link rel="prefetch" href="/assets/js/39.e83c38cf.js"><link rel="prefetch" href="/assets/js/4.caf2fcbd.js"><link rel="prefetch" href="/assets/js/40.acf21eb1.js"><link rel="prefetch" href="/assets/js/41.d164530a.js"><link rel="prefetch" href="/assets/js/5.886701df.js"><link rel="prefetch" href="/assets/js/6.61d8e906.js"><link rel="prefetch" href="/assets/js/7.177acf7a.js"><link rel="prefetch" href="/assets/js/8.84396220.js">
    <link rel="stylesheet" href="/assets/css/0.styles.62005803.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="app"><div id="header"><img id="hero" src="/assets/img/hero.470debc7.png"><span id="title">Spring Boot 学习笔记</span><div id="search-box" class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div><aside id="aside"><div class="__vuescroll" style="height:100%;width:100%;padding:0;position:relative;overflow:hidden;"><div class="__panel __hidebar" style="position:relative;box-sizing:border-box;height:100%;overflow-y:hidden;overflow-x:hidden;transform-origin:;transform:;"><div class="__view" style="position:relative;box-sizing:border-box;min-width:100%;min-height:100%;"><div class="margin-box"><div class="white-line"></div><div class="shell"><div class="sh-header"><div class="dot" style="background-color: #e9524a"></div><div class="dot" style="background-color: #f1ae1b"></div><div class="dot" style="background-color: #59c837"></div></div><div class="sh-body"><div class="line"><span>&gt; </span><span style="color:#4ebdcf">Who are you?</span></div><div class="line right"><span style="color:#97d209">I'm sunn4room</span><span> &lt;</span></div><div class="line right"><span style="color:#97d209">em... Just Sunny Room</span><span> &lt;</span></div><div class="line right"><span style="color:#97d209">And you?</span><span class="cursor">a</span><span> &lt;</span></div></div></div><div class="header-tag" style="font-size:1rem;font-weight:bold;margin-top:1.5rem;">Spring Boot 学习笔记</div><a href="#boot" class="header-tag" style="font-size:1rem;margin-left:1rem;">Boot</a><a href="#maven-方式" class="header-tag" style="font-size:1rem;margin-left:2rem;">maven 方式</a><a href="#gradle-方式" class="header-tag" style="font-size:1rem;margin-left:2rem;">gradle 方式</a><a href="#配置文件-yaml" class="header-tag" style="font-size:1rem;margin-left:2rem;">配置文件（YAML）</a><a href="#profile" class="header-tag" style="font-size:1rem;margin-left:3rem;">profile</a><a href="#配置项绑定" class="header-tag" style="font-size:1rem;margin-left:3rem;">配置项绑定</a><a href="#value" class="header-tag" style="font-size:1rem;margin-left:4rem;">@Value</a><a href="#configurationproperties" class="header-tag" style="font-size:1rem;margin-left:4rem;">@ConfigurationProperties</a><a href="#自动装配" class="header-tag" style="font-size:1rem;margin-left:2rem;">自动装配</a><a href="#条件装配" class="header-tag" style="font-size:1rem;margin-left:2rem;">条件装配</a><a href="#spring-boot-生态" class="header-tag" style="font-size:1rem;margin-left:2rem;">spring-boot 生态</a><a href="#web" class="header-tag" style="font-size:1rem;margin-left:1rem;">Web</a><a href="#类型转换支持" class="header-tag" style="font-size:1rem;margin-left:2rem;">类型转换支持</a><a href="#propertyeditor" class="header-tag" style="font-size:1rem;margin-left:3rem;">PropertyEditor</a><a href="#converter" class="header-tag" style="font-size:1rem;margin-left:3rem;">Converter</a><a href="#formatter" class="header-tag" style="font-size:1rem;margin-left:3rem;">Formatter</a><a href="#webmvc" class="header-tag" style="font-size:1rem;margin-left:2rem;">WebMVC</a><a href="#端点开发" class="header-tag" style="font-size:1rem;margin-left:3rem;">端点开发</a><a href="#参数绑定" class="header-tag" style="font-size:1rem;margin-left:3rem;">参数绑定</a><a href="#扩展点" class="header-tag" style="font-size:1rem;margin-left:3rem;">扩展点</a><a href="#webflux" class="header-tag" style="font-size:1rem;margin-left:2rem;">WebFlux</a><a href="#actuator" class="header-tag" style="font-size:1rem;margin-left:2rem;">Actuator</a><a href="#security" class="header-tag" style="font-size:1rem;margin-left:2rem;">Security</a><a href="#data" class="header-tag" style="font-size:1rem;margin-left:1rem;">Data</a><a href="#事务支持" class="header-tag" style="font-size:1rem;margin-left:2rem;">事务支持</a><a href="#核心组件" class="header-tag" style="font-size:1rem;margin-left:3rem;">核心组件</a><a href="#platformtransactionmanager" class="header-tag" style="font-size:1rem;margin-left:4rem;">PlatformTransactionManager</a><a href="#transactiondefinition" class="header-tag" style="font-size:1rem;margin-left:4rem;">TransactionDefinition</a><a href="#transactionstatus" class="header-tag" style="font-size:1rem;margin-left:4rem;">TransactionStatus</a><a href="#编程式事务管理" class="header-tag" style="font-size:1rem;margin-left:3rem;">编程式事务管理</a><a href="#声明式事务管理" class="header-tag" style="font-size:1rem;margin-left:3rem;">声明式事务管理</a><a href="#jdbc" class="header-tag" style="font-size:1rem;margin-left:2rem;">JDBC</a><a href="#jpa" class="header-tag" style="font-size:1rem;margin-left:2rem;">JPA</a><a href="#方法名推断" class="header-tag" style="font-size:1rem;margin-left:3rem;">方法名推断</a><a href="#query-配置" class="header-tag" style="font-size:1rem;margin-left:3rem;">@Query 配置</a><a href="#动态条件查询支持" class="header-tag" style="font-size:1rem;margin-left:3rem;">动态条件查询支持</a><a href="#分页支持" class="header-tag" style="font-size:1rem;margin-left:3rem;">分页支持</a><a href="#排序支持" class="header-tag" style="font-size:1rem;margin-left:3rem;">排序支持</a><a href="#mybatis-非官方" class="header-tag" style="font-size:1rem;margin-left:2rem;">Mybatis（非官方）</a><a href="#mongodb" class="header-tag" style="font-size:1rem;margin-left:2rem;">MongoDB</a><a href="#elasticsearch" class="header-tag" style="font-size:1rem;margin-left:2rem;">Elasticsearch</a><a href="#mq" class="header-tag" style="font-size:1rem;margin-left:1rem;">MQ</a><a href="#integration" class="header-tag" style="font-size:1rem;margin-left:1rem;">Integration</a><a href="#cache" class="header-tag" style="font-size:1rem;margin-left:1rem;">Cache</a><a href="#ehcache" class="header-tag" style="font-size:1rem;margin-left:2rem;">EhCache</a><a href="#redis" class="header-tag" style="font-size:1rem;margin-left:2rem;">Redis</a><a href="#batch" class="header-tag" style="font-size:1rem;margin-left:1rem;">Batch</a><a href="#test" class="header-tag" style="font-size:1rem;margin-left:1rem;">Test</a><a href="#logging" class="header-tag endtag" style="font-size:1rem;margin-left:1rem;">Logging</a></div></div></div></div></aside><div id="curtain"></div><main id="main"><div class="__vuescroll" style="height:100%;width:100%;padding:0;position:relative;overflow:hidden;"><div class="__panel __hidebar" style="position:relative;box-sizing:border-box;height:100%;overflow-y:hidden;overflow-x:hidden;transform-origin:;transform:;"><div class="__view" style="position:relative;box-sizing:border-box;min-width:100%;min-height:100%;"><div class="margin-box"><div class="white-line"></div><div class="box"><div class="post-tags"><span class="post-tag ca-tag"><span><a class="firstca" style="color: white">程序设计</a><span><svg aria-hidden="true" focusable="false" data-prefix="fa" data-icon="caret-right" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 192 512" class="svg-inline--fa fa-caret-right fa-w-6" style="width:1rem;"><path fill="currentColor" d="M0 384.662V127.338c0-17.818 21.543-26.741 34.142-14.142l128.662 128.662c7.81 7.81 7.81 20.474 0 28.284L34.142 398.804C21.543 411.404 0 402.48 0 384.662z"></path></svg></span></span><span><a class="endcd" style="color: white">Java</a><!----></span></span><a class="ta-tag post-tag">java</a><a class="ta-tag post-tag">spring</a><a class="ta-tag post-tag">spring-boot</a><span class="da-tag post-tag">2020.08.23</span><!----></div></div><div class="box"><h1 style="text-align:center;">Spring Boot 学习笔记</h1><div class="markdown-body content__default"><h1 id="spring-boot-学习笔记"><a href="#spring-boot-学习笔记" class="header-anchor">#</a> Spring Boot 学习笔记</h1> <p>Spring Boot 在 Spring 容器的基础上，旨在实现 “开箱即用” ，只需要引入相关 jar 包，统一在 application.yaml 做一些必要的配置，其他配置项遵循 “约定大于配置” 原则，就可以直接使用。</p> <ul><li>创建独立的 Spring 应用程序</li> <li>嵌入的 Tomcat 、Jetty 或者 Undertow，无须部署 WAR 文件</li> <li>允许通过 Maven 来根据需要获取 starter</li> <li>尽可能地自动配置 Spring</li> <li>提供生产就绪型功能，如指标、健康检查和外部配置</li> <li>绝对没有代码生成，对 XML 没有要求配置</li></ul> <h2 id="boot"><a href="#boot" class="header-anchor">#</a> Boot</h2> <h3 id="maven-方式"><a href="#maven-方式" class="header-anchor">#</a> maven 方式</h3> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">&gt;</span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-parent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.x.x.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>xxx<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>xxx<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>xxx<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>packaging</span><span class="token punctuation">&gt;</span></span>jar<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>packaging</span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>xxx<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url</span><span class="token punctuation">&gt;</span></span>xxx<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url</span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>java.version</span><span class="token punctuation">&gt;</span></span>11<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>java.version</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><blockquote><p>当当前项目已经存在 parent 时，可以使用：</p> <div class="language-xml extra-class"><pre class="language-xml"><code>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencyManagement</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-dependencies<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.x.x.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">&gt;</span></span>pom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>import<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencyManagement</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></blockquote> <div class="language-sh extra-class"><pre class="language-sh"><code>$ XXX <span class="token operator">=</span> <span class="token string">&quot;xxx&quot;</span> <span class="token operator">&amp;&amp;</span> mvn spring-boot:run -Dspring-boot.run.jvmArguments<span class="token operator">=</span><span class="token string">&quot;...&quot;</span> -Dspring- boot.run.arguments<span class="token operator">=</span><span class="token string">&quot;...&quot;</span>
</code></pre></div><blockquote><p>开发多模块的时候，父模块配置如下：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>skip</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>skip</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>可运行的 spring boot 子模块配置如下：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fork</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fork</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>skip</span><span class="token punctuation">&gt;</span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>skip</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>执行如下命令只运行子模块：</p> <div class="language-sh extra-class"><pre class="language-sh"><code>$ mvn -pl xxx.xxx.xxx:xxx-xxx -am spring-boot:run
</code></pre></div></blockquote> <h3 id="gradle-方式"><a href="#gradle-方式" class="header-anchor">#</a> gradle 方式</h3> <h3 id="配置文件-yaml"><a href="#配置文件-yaml" class="header-anchor">#</a> 配置文件（YAML）</h3> <p>Spring Boot 采用 yaml 或者 properties 文件进行配置，通常使用 yaml</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> xxx
  <span class="token key atrule">xxx</span><span class="token punctuation">:</span>
    <span class="token key atrule">xxx</span><span class="token punctuation">:</span> xxx
    <span class="token key atrule">xxx</span><span class="token punctuation">:</span> xxx
  <span class="token key atrule">xxx</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">xxx</span><span class="token punctuation">:</span> xxx
  <span class="token punctuation">-</span> <span class="token key atrule">xxx</span><span class="token punctuation">:</span> xxx
</code></pre></div><blockquote><p>可以通过添加命令行参数的形式动态修改配置项，如 <code>--xxx.xxx=xxx</code></p></blockquote> <blockquote><p>yaml 内部也可以引用系统外部的环境变量值赋值配置项，如 <code>${XXX[:default-value]}</code></p></blockquote> <h4 id="profile"><a href="#profile" class="header-anchor">#</a> profile</h4> <h4 id="配置项绑定"><a href="#配置项绑定" class="header-anchor">#</a> 配置项绑定</h4> <h5 id="value"><a href="#value" class="header-anchor">#</a> @Value</h5> <h5 id="configurationproperties"><a href="#configurationproperties" class="header-anchor">#</a> @ConfigurationProperties</h5> <h3 id="自动装配"><a href="#自动装配" class="header-anchor">#</a> 自动装配</h3> <h3 id="条件装配"><a href="#条件装配" class="header-anchor">#</a> 条件装配</h3> <h3 id="spring-boot-生态"><a href="#spring-boot-生态" class="header-anchor">#</a> spring-boot 生态</h3> <ul><li><strong>spring-boot-devtools</strong></li> <li><strong>spring-boot-starter-parent</strong></li> <li><strong>spring-boot-starter-test</strong></li> <li><strong>spring-boot-starter-logging</strong></li> <li><strong>spring-boot-starter-web</strong></li> <li><strong>spring-boot-starter-webflux</strong></li> <li><strong>spring-boot-starter-actuator</strong></li> <li><strong>spring-boot-starter-security</strong></li> <li><strong>spring-boot-starter-data-jdbc</strong></li> <li><strong>spring-boot-starter-data-jpa</strong></li> <li><strong>spring-boot-starter-data-redis</strong></li> <li><strong>spring-boot-starter-data-mongodb</strong></li> <li><strong>spring-boot-starter-data-elasticsearch</strong></li> <li><strong>spring-boot-starter-cache</strong></li> <li><strong>spring-boot-starter-amqp</strong></li> <li><strong>spring-boot-starter-quartz</strong></li></ul> <h2 id="web"><a href="#web" class="header-anchor">#</a> Web</h2> <h3 id="类型转换支持"><a href="#类型转换支持" class="header-anchor">#</a> 类型转换支持</h3> <p>转换方式有两种，一种是使用PropertyEditor，另外一种是使用Converter。</p> <h4 id="propertyeditor"><a href="#propertyeditor" class="header-anchor">#</a> PropertyEditor</h4> <h4 id="converter"><a href="#converter" class="header-anchor">#</a> Converter</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Converter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span><span class="token punctuation">,</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
	<span class="token class-name">T</span> <span class="token function">convert</span><span class="token punctuation">(</span><span class="token class-name">S</span> source<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="formatter"><a href="#formatter" class="header-anchor">#</a> Formatter</h4> <h3 id="webmvc"><a href="#webmvc" class="header-anchor">#</a> WebMVC</h3> <blockquote><p><code>spring-boot-starter-web</code></p></blockquote> <p><img src="/assets/img/SpringMVC.c743d288.png" alt=""></p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">mvc</span><span class="token punctuation">:</span>
    <span class="token key atrule">view</span><span class="token punctuation">:</span>
      <span class="token key atrule">prefix</span><span class="token punctuation">:</span> /
      <span class="token key atrule">suffix</span><span class="token punctuation">:</span> .html <span class="token comment"># 自动寻找static文件夹下的静态网页</span>
<span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8080</span>
</code></pre></div><h4 id="端点开发"><a href="#端点开发" class="header-anchor">#</a> 端点开发</h4> <h4 id="参数绑定"><a href="#参数绑定" class="header-anchor">#</a> 参数绑定</h4> <h4 id="扩展点"><a href="#扩展点" class="header-anchor">#</a> 扩展点</h4> <p>注解开发</p> <ul><li>@Controller：控制器声明</li> <li>@RequestMapping：请求方法映射（捕捉）</li> <li>@RequestParam：query 参数映射</li> <li>@RequestHeader：header 参数映射</li> <li>@RequestAttribute：请求属性参数映射</li> <li>@PahVariable：路径参数映射</li> <li>@CookieValue：Cookie 参数映射</li> <li>@RequestBody：json/xml 请求体参数映射</li> <li>@ResponseBody：json/xml 响应体声明</li> <li>@RestController：@Controller + @ResponseBody</li> <li>@ExceptionHandler：异常处理器</li> <li>@ControllerAdvise：控制器增强，通常配合 @ExceptionHandler 实现全局异常处理</li> <li>@RestControllerAdvise：@ControllerAdvise + @ResponseBody</li></ul> <p>参数解析绑定</p> <p>Controller 方法体的参数是通过 Spring 配好的参数解析器解析出来并传递的，每个解析器都有一个 supportsParameter 方法指示该解析器是否支持指定的参数。</p> <ul><li>根据参数名寻找</li> <li>根据注解指定</li> <li>根据对象的属性名寻找，并自定创建对象并赋值</li> <li>...</li></ul> <p>解析出来的是字符串，还需要类型转换器转换成参数的类型进行绑定，默认支持</p> <ul><li>基础类型</li> <li>String</li> <li>包装类</li> <li>...</li></ul> <blockquote><p>自定义类型转换器</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">XxxConverter</span> <span class="token keyword">implements</span> <span class="token class-name">Converter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Xxx</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    
       <span class="token annotation punctuation">@Override</span>
       <span class="token keyword">public</span> <span class="token class-name">Xxx</span> <span class="token function">convert</span><span class="token punctuation">(</span><span class="token class-name">String</span> source<span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token comment">// ...</span>
       <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></blockquote> <blockquote><p>有些类型的参数是 MVC 内部类型，可以跳过解析直接绑定，常见的就是两个：HttpServletRequest 和 HttpServletResponse</p></blockquote> <p>HandlerInterceptor</p> <p>ResponseBodyAdvice</p> <h3 id="webflux"><a href="#webflux" class="header-anchor">#</a> WebFlux</h3> <blockquote><p><code>spring-boot-starter-webflux</code></p></blockquote> <p>与 WebMVC 的开发方式完全一致，不同点在于，引入了 Netty 作为默认的服务提供者，拓展了对 Reactor API 的支持，即端点方法可以放回 Mono/Flux ，实现了服务器端的请求异步处理，分离了请求接收线程和业务处理线程。</p> <blockquote><p>但是，webflux 对于单次请求并没有明显的性能提升，它的意义在于线程资源的整合，降低了应用的内存占用，提高了应用的吞吐量。</p></blockquote> <h3 id="actuator"><a href="#actuator" class="header-anchor">#</a> Actuator</h3> <p>Spring Boot Actuator的关键特性是在应用程序里提供众多Web端点，通过它们了解应用程序运行时的内部状况。</p> <table><thead><tr><th style="text-align:left;">ID</th> <th style="text-align:left;">Description</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>auditevents</code></td> <td style="text-align:left;">Exposes audit events information for the current application. Requires an <code>AuditEventRepository</code> bean.</td></tr> <tr><td style="text-align:left;"><code>beans</code></td> <td style="text-align:left;">Displays a complete list of all the Spring beans in your application.</td></tr> <tr><td style="text-align:left;"><code>caches</code></td> <td style="text-align:left;">Exposes available caches.</td></tr> <tr><td style="text-align:left;"><code>conditions</code></td> <td style="text-align:left;">Shows the conditions that were evaluated on configuration and auto-configuration classes and the reasons why they did or did not match.</td></tr> <tr><td style="text-align:left;"><code>configprops</code></td> <td style="text-align:left;">Displays a collated list of all <code>@ConfigurationProperties</code>.</td></tr> <tr><td style="text-align:left;"><code>env</code></td> <td style="text-align:left;">Exposes properties from Spring’s <code>ConfigurableEnvironment</code>.</td></tr> <tr><td style="text-align:left;"><code>flyway</code></td> <td style="text-align:left;">Shows any Flyway database migrations that have been applied. Requires one or more <code>Flyway</code> beans.</td></tr> <tr><td style="text-align:left;"><code>health</code></td> <td style="text-align:left;">Shows application health information.</td></tr> <tr><td style="text-align:left;"><code>httptrace</code></td> <td style="text-align:left;">Displays HTTP trace information (by default, the last 100 HTTP request-response exchanges). Requires an <code>HttpTraceRepository</code> bean.</td></tr> <tr><td style="text-align:left;"><code>info</code></td> <td style="text-align:left;">Displays arbitrary application info.</td></tr> <tr><td style="text-align:left;"><code>integrationgraph</code></td> <td style="text-align:left;">Shows the Spring Integration graph. Requires a dependency on <code>spring-integration-core</code>.</td></tr> <tr><td style="text-align:left;"><code>loggers</code></td> <td style="text-align:left;">Shows and modifies the configuration of loggers in the application.</td></tr> <tr><td style="text-align:left;"><code>liquibase</code></td> <td style="text-align:left;">Shows any Liquibase database migrations that have been applied. Requires one or more <code>Liquibase</code> beans.</td></tr> <tr><td style="text-align:left;"><code>metrics</code></td> <td style="text-align:left;">Shows ‘metrics’ information for the current application.</td></tr> <tr><td style="text-align:left;"><code>mappings</code></td> <td style="text-align:left;">Displays a collated list of all <code>@RequestMapping</code> paths.</td></tr> <tr><td style="text-align:left;"><code>scheduledtasks</code></td> <td style="text-align:left;">Displays the scheduled tasks in your application.</td></tr> <tr><td style="text-align:left;"><code>sessions</code></td> <td style="text-align:left;">Allows retrieval and deletion of user sessions from a Spring Session-backed session store. Requires a Servlet-based web application using Spring Session.</td></tr> <tr><td style="text-align:left;"><code>shutdown</code></td> <td style="text-align:left;">Lets the application be gracefully shutdown. Disabled by default.</td></tr> <tr><td style="text-align:left;"><code>threaddump</code></td> <td style="text-align:left;">Performs a thread dump.</td></tr></tbody></table> <table><thead><tr><th style="text-align:left;">Property</th> <th style="text-align:left;">Default</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>management.endpoints.jmx.exposure.exclude</code></td> <td style="text-align:left;"></td></tr> <tr><td style="text-align:left;"><code>management.endpoints.jmx.exposure.include</code></td> <td style="text-align:left;"><code>*</code></td></tr> <tr><td style="text-align:left;"><code>management.endpoints.web.exposure.exclude</code></td> <td style="text-align:left;"></td></tr> <tr><td style="text-align:left;"><code>management.endpoints.web.exposure.include</code></td> <td style="text-align:left;"><code>info, health</code></td></tr></tbody></table> <h3 id="security"><a href="#security" class="header-anchor">#</a> Security</h3> <blockquote><p><code>spring-boot-starter-security</code></p></blockquote> <p>Spring Security 是 Spring 实现的认证授权框架，随着 Spring Boot 的流行，逐渐成为 Shiro 的替代者。</p> <blockquote><p>认证：确认用户身份</p> <ul><li>基于 Session 的认证，即服务端维护用户登录信息</li> <li>基于 Token 的认证，即客户端维护用户登录信息</li></ul> <p>授权：确认某个身份是否有权限对某种资源进行某种操作</p> <ul><li>ACL：用户直接维护了一个资源操作的列表表示它的权限</li> <li>ABAC：基于属性的访问控制，即用户属性、资源属性、操作属性、环境属性等输入参数计算出是否有权限</li> <li>RBAC：基于角色的访问控制，即资源操作和用户解耦，中间加个角色，资源操作和用户分别与角色进行联系</li></ul></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@EnableWebSecurity</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MySecurityConfig</span> <span class="token keyword">extends</span> <span class="token class-name">WebSecurityConfigurerAdapter</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// 安全配置</span>
        http<span class="token punctuation">.</span><span class="token function">authorizeRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">&quot;/xx/xx&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">&quot;/xx/xx&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hasRole</span><span class="token punctuation">(</span><span class="token string">&quot;xx&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        http<span class="token punctuation">.</span><span class="token function">formLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">loginPage</span><span class="token punctuation">(</span><span class="token string">&quot;/xx&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">.</span><span class="token function">successForwardUrl</span><span class="token punctuation">(</span><span class="token string">&quot;/xx&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">failureForwardUrl</span><span class="token punctuation">(</span><span class="token string">&quot;/xx&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        http<span class="token punctuation">.</span><span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">logoutSuccessUrl</span><span class="token punctuation">(</span><span class="token string">&quot;/xx&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        http<span class="token punctuation">.</span><span class="token function">rememberMe</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">rememberMeParameter</span><span class="token punctuation">(</span><span class="token string">&quot;remeber&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// UserDetailService</span>
<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyUserDetailService</span> <span class="token keyword">implements</span> <span class="token class-name">UserDetailService</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">UserDetails</span> <span class="token function">loadUserByUsername</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">UsernameNotFoundException</span> <span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
        <span class="token keyword">return</span> <span class="token class-name">User</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">username</span><span class="token punctuation">(</span><span class="token string">&quot;xxx&quot;</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">password</span><span class="token punctuation">(</span><span class="token string">&quot;xxx&quot;</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">roles</span><span class="token punctuation">(</span><span class="token string">&quot;xxx&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">authorities</span><span class="token punctuation">(</span><span class="token string">&quot;xxx&quot;</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="data"><a href="#data" class="header-anchor">#</a> Data</h2> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> xxx
    <span class="token key atrule">url</span><span class="token punctuation">:</span> xxx
    <span class="token key atrule">username</span><span class="token punctuation">:</span> xxx
    <span class="token key atrule">password</span><span class="token punctuation">:</span> xxx
    
    <span class="token key atrule">hikari</span><span class="token punctuation">:</span>
      <span class="token key atrule">minimum-idle</span><span class="token punctuation">:</span> <span class="token number">10</span>
      <span class="token key atrule">maximum-pool-size</span><span class="token punctuation">:</span> <span class="token number">20</span>
      <span class="token key atrule">idle-timeout</span><span class="token punctuation">:</span> <span class="token number">500000</span>
      <span class="token key atrule">connection-timeout</span><span class="token punctuation">:</span> <span class="token number">60000</span>
</code></pre></div><blockquote><p>动态数据源：<code>com.baomidou:dynamic-datasource-spring-boot-starter</code></p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
    <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
     <span class="token key atrule">dynamic</span><span class="token punctuation">:</span>
       <span class="token key atrule">primary</span><span class="token punctuation">:</span> master
       <span class="token key atrule">strict</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
       <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
         <span class="token key atrule">master</span><span class="token punctuation">:</span>
           <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//xx.xx.xx.xx<span class="token punctuation">:</span>3306/dynamic
           <span class="token key atrule">username</span><span class="token punctuation">:</span> root
           <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">123456</span>
           <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.jdbc.Driver <span class="token comment"># 3.2.0开始支持SPI可省略此配置</span>
         <span class="token key atrule">slave_1</span><span class="token punctuation">:</span>
           <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//xx.xx.xx.xx<span class="token punctuation">:</span>3307/dynamic
           <span class="token key atrule">username</span><span class="token punctuation">:</span> root
           <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">123456</span>
           <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.jdbc.Driver
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 注解在service、mapper、repository的类上或方法上，实现动态切换</span>
<span class="token annotation punctuation">@DS</span><span class="token punctuation">(</span><span class="token string">&quot;slave_1&quot;</span><span class="token punctuation">)</span>
</code></pre></div></blockquote> <h3 id="事务支持"><a href="#事务支持" class="header-anchor">#</a> 事务支持</h3> <p>Spring 提供了一致的事务管理抽象层，具有以下特性：</p> <ul><li>统一了不同框架的事务 API</li> <li>简化了编程式事务管理，同时支持声明式事务管理</li> <li>与 Spring 数据访问模块进行完美整合</li></ul> <h4 id="核心组件"><a href="#核心组件" class="header-anchor">#</a> 核心组件</h4> <h5 id="platformtransactionmanager"><a href="#platformtransactionmanager" class="header-anchor">#</a> PlatformTransactionManager</h5> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">PlatformTransactionManager</span> <span class="token punctuation">{</span>
    <span class="token class-name">TransactionStatus</span> <span class="token function">getTransaction</span><span class="token punctuation">(</span><span class="token class-name">TransactionDefinition</span> definition<span class="token punctuation">)</span>
        	<span class="token keyword">throws</span> <span class="token class-name">TransactionException</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">commit</span><span class="token punctuation">(</span><span class="token class-name">TransactionStatus</span> status<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">TransactionException</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">rollback</span><span class="token punctuation">(</span><span class="token class-name">TransactionStatus</span> status<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">TransactionException</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h5 id="transactiondefinition"><a href="#transactiondefinition" class="header-anchor">#</a> TransactionDefinition</h5> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">TransactionDefinition</span> <span class="token punctuation">{</span>
	<span class="token comment">// 加入到外部事务，如果没有则新建一个事务</span>
	<span class="token keyword">int</span> PROPAGATION_REQUIRED <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token comment">// 加入到外部事务，如果没有则以非事务的形式执行</span>
    <span class="token keyword">int</span> PROPAGATION_SUPPORTS <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token comment">// 加入到外部事务，如果没有则抛出一个异常</span>
    <span class="token keyword">int</span> PROPAGATION_MANDATORY <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token comment">// 新建一个事务，如果有外部事务则挂起</span>
    <span class="token keyword">int</span> PROPAGATION_REQUIRES_NEW <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
    <span class="token comment">// 以非事务的形式执行,如果有外部事务则挂起</span>
    <span class="token keyword">int</span> PROPAGATION_NOT_SUPPORTED <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
    <span class="token comment">// 以非事务的形式执行,如果有外部事务则抛出一个异常</span>
    <span class="token keyword">int</span> PROPAGATION_NEVER <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
    <span class="token comment">// 嵌套到外部事务（可以建立内部的回滚点）,如果没有则新建一个事务</span>
    <span class="token keyword">int</span> PROPAGATION_NESTED <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 1. 脏读 - 事务A更新记录但未提交，事务B查询出A未提交记录</span>
    <span class="token comment">// 2. 不可重复读 - 事务A读取一次，此时事务B对数据进行了更新或删除操作，事务A再次查询数据不一致</span>
    <span class="token comment">// 3. 幻读 - 事务A读取一次，此时事务B插入一条数据事务A再次查询，记录多了</span>
    
    <span class="token comment">// 1 x 2 x 3 x</span>
    <span class="token keyword">int</span> ISOLATION_READ_UNCOMMITTED <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token comment">// 1 o 2 x 3 x</span>
    <span class="token keyword">int</span> ISOLATION_READ_COMMITTED <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token comment">// 1 o 2 o 3 x</span>
    <span class="token keyword">int</span> ISOLATION_REPEATABLE_READ <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
    <span class="token comment">// 1 o 2 o 3 o</span>
    <span class="token keyword">int</span> ISOLATION_SERIALIZABLE <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>
    
    <span class="token keyword">int</span> <span class="token function">getPropagationBehavior</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> <span class="token function">getIsolationLevel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> <span class="token function">getTimeout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">boolean</span> <span class="token function">isReadOnly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h5 id="transactionstatus"><a href="#transactionstatus" class="header-anchor">#</a> TransactionStatus</h5> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">TransactionStatus</span> 
<span class="token keyword">extends</span> <span class="token class-name">TransactionExecution</span><span class="token punctuation">,</span> <span class="token class-name">SavepointManager</span><span class="token punctuation">,</span> <span class="token class-name">Flushable</span> <span class="token punctuation">{</span>
	<span class="token keyword">boolean</span> <span class="token function">hasSavepoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// ---</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">TransactionExecution</span> <span class="token punctuation">{</span>
    <span class="token keyword">boolean</span> <span class="token function">isNewTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">setRollbackOnly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">boolean</span> <span class="token function">isRollbackOnly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">boolean</span> <span class="token function">isCompleted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// ---</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">SavepointManager</span> <span class="token punctuation">{</span>
    <span class="token class-name">Object</span> <span class="token function">createSavepoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">rollbackToSavepoint</span><span class="token punctuation">(</span><span class="token class-name">Object</span> savepoint<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">releaseSavepoint</span><span class="token punctuation">(</span><span class="token class-name">Object</span> savepoint<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// ---</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Flushable</span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="编程式事务管理"><a href="#编程式事务管理" class="header-anchor">#</a> 编程式事务管理</h4> <p>TransactionTemplate 位于 org.springframework.transaction.support 下，提供事务管理的模板类</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SimpleService</span> <span class="token keyword">implements</span> <span class="token class-name">Service</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">TransactionTemplate</span> transactionTemplate<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">SimpleService</span><span class="token punctuation">(</span><span class="token class-name">PlatformTransactionManager</span> transactionManager<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>transactionTemplate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TransactionTemplate</span><span class="token punctuation">(</span>transactionManager<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>transactionTemplate<span class="token punctuation">.</span><span class="token function">setXxx</span><span class="token punctuation">(</span>xxx<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>transactionTemplate<span class="token punctuation">.</span><span class="token function">setXxx</span><span class="token punctuation">(</span>xxx<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">someServiceMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> transactionTemplate<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">TransactionCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">doInTransaction</span><span class="token punctuation">(</span><span class="token class-name">TransactionStatus</span> status<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// ...</span>
                status<span class="token punctuation">.</span><span class="token function">setRollbackOnly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// ...</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">someServiceMethodWithoutResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        transactionTemplate<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">TransactionCallbackWithoutResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doInTransactionWithoutResult</span><span class="token punctuation">(</span><span class="token class-name">TransactionStatus</span> status<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// ...</span>
                status<span class="token punctuation">.</span><span class="token function">setRollbackOnly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// ...</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="声明式事务管理"><a href="#声明式事务管理" class="header-anchor">#</a> 声明式事务管理</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 配置 transaction manager</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@ComponentScan</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">XxxConfig</span> <span class="token punctuation">{</span>
	<span class="token annotation punctuation">@bean</span>
	<span class="token keyword">public</span> <span class="token class-name">PlatformTransactionManager</span> <span class="token function">transactionManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Xxx</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 声明</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Xxx</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token string">&quot;transactionManager&quot;</span><span class="token punctuation">,</span>propagation<span class="token operator">=</span>xxx<span class="token punctuation">,</span>isolation<span class="token operator">=</span>xxx<span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Xxx</span> <span class="token function">xxx</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>被声明的方法应该是 public 的，否则不会生效</p></blockquote> <h3 id="jdbc"><a href="#jdbc" class="header-anchor">#</a> JDBC</h3> <blockquote><p><code>spring-boot-starter-data-jdbc</code></p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">UserService</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">JdbcTemplate</span> jdbcTemplate<span class="token punctuation">;</span>

    <span class="token class-name">UserServiceImpl</span><span class="token punctuation">(</span><span class="token class-name">JdbcTemplate</span> jdbcTemplate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>jdbcTemplate <span class="token operator">=</span> jdbcTemplate<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">Integer</span> age<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> jdbcTemplate<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token string">&quot;insert into USER(NAME, AGE) values(?, ?)&quot;</span><span class="token punctuation">,</span> name<span class="token punctuation">,</span> age<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">getByName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> users <span class="token operator">=</span> jdbcTemplate<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;select NAME, AGE from USER where NAME = ?&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>resultSet<span class="token punctuation">,</span> i<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            user<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span>resultSet<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;NAME&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            user<span class="token punctuation">.</span><span class="token function">setAge</span><span class="token punctuation">(</span>resultSet<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token string">&quot;AGE&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> user<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> users<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">deleteByName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> jdbcTemplate<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token string">&quot;delete from USER where NAME = ?&quot;</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getAllUsers</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> jdbcTemplate<span class="token punctuation">.</span><span class="token function">queryForObject</span><span class="token punctuation">(</span><span class="token string">&quot;select count(1) from USER&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">deleteAllUsers</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> jdbcTemplate<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token string">&quot;delete from USER&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h3 id="jpa"><a href="#jpa" class="header-anchor">#</a> JPA</h3> <blockquote><p><code>spring-boot-starter-data-jpa</code></p></blockquote> <p>默认采用了 Hibernate 的实现</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">jpa</span><span class="token punctuation">:</span>
    <span class="token key atrule">properties</span><span class="token punctuation">:</span>
      <span class="token key atrule">hibernate</span><span class="token punctuation">:</span>
        <span class="token key atrule">hbm2ddl</span><span class="token punctuation">:</span>
          <span class="token key atrule">auto</span><span class="token punctuation">:</span> create <span class="token punctuation">|</span> create<span class="token punctuation">-</span>drop <span class="token punctuation">|</span> update
    <span class="token key atrule">show-sql</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre></div><h4 id="方法名推断"><a href="#方法名推断" class="header-anchor">#</a> 方法名推断</h4> <h4 id="query-配置"><a href="#query-配置" class="header-anchor">#</a> @Query 配置</h4> <h4 id="动态条件查询支持"><a href="#动态条件查询支持" class="header-anchor">#</a> 动态条件查询支持</h4> <h4 id="分页支持"><a href="#分页支持" class="header-anchor">#</a> 分页支持</h4> <h4 id="排序支持"><a href="#排序支持" class="header-anchor">#</a> 排序支持</h4> <h3 id="mybatis-非官方"><a href="#mybatis-非官方" class="header-anchor">#</a> Mybatis（非官方）</h3> <blockquote><p><code>org.mybatis.spring.boot:mybatis-spring-boot-starter</code></p></blockquote> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">mybatis</span><span class="token punctuation">:</span>
  <span class="token key atrule">type-aliases-package</span><span class="token punctuation">:</span> com.example.domain.model
  <span class="token key atrule">type-handlers-package</span><span class="token punctuation">:</span> com.example.typehandler
  <span class="token key atrule">configuration</span><span class="token punctuation">:</span>
    <span class="token key atrule">map-underscore-to-camel-case</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">default-fetch-size</span><span class="token punctuation">:</span> <span class="token number">100</span>
    <span class="token key atrule">default-statement-timeout</span><span class="token punctuation">:</span> <span class="token number">30</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Mapper</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">CityMapper</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">&quot;SELECT * FROM CITY WHERE state = #{state}&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">City</span> <span class="token function">findByState</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;state&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> state<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SampleMybatisApplication</span> <span class="token keyword">implements</span> <span class="token class-name">CommandLineRunner</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">CityMapper</span> cityMapper<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">SampleMybatisApplication</span><span class="token punctuation">(</span><span class="token class-name">CityMapper</span> cityMapper<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>cityMapper <span class="token operator">=</span> cityMapper<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">SampleMybatisApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>cityMapper<span class="token punctuation">.</span><span class="token function">findByState</span><span class="token punctuation">(</span><span class="token string">&quot;CA&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>这里的开发模式沿用了Mybatis 原生的 @Mapper ，而不是经典的 @Repository</p></blockquote> <h3 id="mongodb"><a href="#mongodb" class="header-anchor">#</a> MongoDB</h3> <blockquote><p><code>spring-boot-starter-data-mongodb</code></p></blockquote> <h3 id="elasticsearch"><a href="#elasticsearch" class="header-anchor">#</a> Elasticsearch</h3> <blockquote><p><code>spring-boot-starter-data-elasticsearch</code></p></blockquote> <h2 id="mq"><a href="#mq" class="header-anchor">#</a> MQ</h2> <h2 id="integration"><a href="#integration" class="header-anchor">#</a> Integration</h2> <h2 id="cache"><a href="#cache" class="header-anchor">#</a> Cache</h2> <blockquote><p><code>spring-boot-starter-cache</code></p></blockquote> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cache</span><span class="token punctuation">:</span>
    <span class="token key atrule">type</span><span class="token punctuation">:</span> xxx <span class="token comment"># 显式指定缓存提供者</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@EnableCaching</span>
<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Xxx</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@CacheConfig</span><span class="token punctuation">(</span>cacheNames <span class="token operator">=</span> <span class="token string">&quot;users&quot;</span><span class="token punctuation">)</span> <span class="token comment">// map 名</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserRepository</span> <span class="token keyword">extends</span> <span class="token class-name">JpaRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Cacheable</span><span class="token punctuation">(</span>key <span class="token operator">=</span> <span class="token string">&quot;#p0&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 键值</span>
    <span class="token class-name">User</span> <span class="token function">findById</span><span class="token punctuation">(</span><span class="token class-name">Long</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token annotation punctuation">@CachePut</span><span class="token punctuation">(</span>key <span class="token operator">=</span> <span class="token string">&quot;#p0.id&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">User</span> <span class="token function">updateUser</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token annotation punctuation">@CacheEvict</span><span class="token punctuation">(</span>key <span class="token operator">=</span> <span class="token string">&quot;#p0&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">User</span> <span class="token function">deleteUserById</span><span class="token punctuation">(</span><span class="token class-name">Long</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre></div><p>缓存提供者缺省时的搜索顺序：</p> <ul><li>Generic</li> <li>JCache (JSR-107) (EhCache 3, Hazelcast, Infinispan, and others)</li> <li>EhCache 2.x</li> <li>Hazelcast</li> <li>Infinispan</li> <li>Couchbase</li> <li>Redis</li> <li>Caffeine</li> <li>Simple</li></ul> <h3 id="ehcache"><a href="#ehcache" class="header-anchor">#</a> EhCache</h3> <blockquote><p><code>net.sf.ehcache:ehcache</code></p></blockquote> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token comment">&lt;!-- ehcache.xml --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ehcache</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xsi:</span>noNamespaceSchemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ehcache.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cache</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>users<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name">maxEntriesLocalHeap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>200<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name">timeToLiveSeconds</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>600<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cache</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ehcache</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><blockquote><p>EhCache 是进程级别的缓存方案，虽然也可以进行集群部署，但不适合上生产，生产环境下推荐使用 Redis 缓存方案。</p></blockquote> <h3 id="redis"><a href="#redis" class="header-anchor">#</a> Redis</h3> <blockquote><p><code>spring-boot-starter-data-redis</code></p></blockquote> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">redis</span><span class="token punctuation">:</span>
    <span class="token key atrule">host</span><span class="token punctuation">:</span> localhost
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">6379</span>
    <span class="token key atrule">lettuce</span><span class="token punctuation">:</span>
      <span class="token key atrule">pool</span><span class="token punctuation">:</span>
        <span class="token key atrule">max-idle</span><span class="token punctuation">:</span> <span class="token number">8</span>
        <span class="token key atrule">max-active</span><span class="token punctuation">:</span> <span class="token number">8</span>
        <span class="token key atrule">max-wait</span><span class="token punctuation">:</span> <span class="token punctuation">-</span>1ms
        <span class="token key atrule">min-idle</span><span class="token punctuation">:</span> <span class="token number">0</span>
      <span class="token key atrule">shutdown-timeout</span><span class="token punctuation">:</span> 100ms
</code></pre></div><p>RedisTemplate</p> <p>SessionCallback</p> <p>RedisCallback</p> <p>事务</p> <p>流水线</p> <h2 id="batch"><a href="#batch" class="header-anchor">#</a> Batch</h2> <p>Spring Batch 是一个轻量级的批处理框架。它和普通的方法调用的区别在于提供了完善的任务管理 API ，可观察、可重试、可跳过等。</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">batch</span><span class="token punctuation">:</span>
    <span class="token key atrule">job</span><span class="token punctuation">:</span>
      <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">false</span> <span class="token comment"># 容器启动后不自动遍历执行job</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@EnableBatchProcessing</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BatchConfig</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">JobBuilderFactory</span> jobBuilderFactory<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">StepBuilderFactory</span> stepBuilderFactory<span class="token punctuation">;</span>
    
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">Step</span> <span class="token function">step1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>sf<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;step1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">tasklet</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Tasklet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token class-name">RepeatStatus</span> <span class="token function">execute</span><span class="token punctuation">(</span>
                    <span class="token class-name">StepContribution</span> contribution<span class="token punctuation">,</span>
                    <span class="token class-name">ChunkContext</span> chunkContext<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;step2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">Step</span> <span class="token function">step2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>stepBuilderFactory<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;step2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span><span class="token function">chunk</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">reader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ItemReader</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token keyword">private</span> <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">,</span>
                           <span class="token class-name">UnexpectedInputException</span><span class="token punctuation">,</span>
                           <span class="token class-name">ParseException</span><span class="token punctuation">,</span>
                           <span class="token class-name">NonTransientResourceException</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">&lt;</span> <span class="token number">50</span><span class="token punctuation">)</span>
                    <span class="token keyword">return</span> count<span class="token operator">++</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">processor</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ItemProcessor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> item<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>item <span class="token operator">%</span> <span class="token number">8</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
                    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> item<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">writer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ItemWriter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> items<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>items<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">Job</span> <span class="token function">job</span><span class="token punctuation">(</span><span class="token class-name">Step</span> step1<span class="token punctuation">,</span> <span class="token class-name">Step</span> step2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        jobBuilderFactory<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;job&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span>step1<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>step2<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>自身不具备调度功能，可以借助 Web 端点、Quartz 等方式进行调度：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// autowire job and joblauncher</span>
<span class="token class-name">JobParameters</span> jobParameters <span class="token operator">=</span> jobParametersBuilder<span class="token punctuation">.</span><span class="token function">addString</span><span class="token punctuation">(</span><span class="token string">&quot;info&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;sunny&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">toJobParameters</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
jobLauncher<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>job<span class="token punctuation">,</span> jobParameters<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></blockquote> <h2 id="test"><a href="#test" class="header-anchor">#</a> Test</h2> <blockquote><p><code>spring-boot-starter-test</code></p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Assertions</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span> <span class="token comment">// 断言</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Assumptions</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span> <span class="token comment">// 前置条件</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">SpringBootTest</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AppTest</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testAppHasAGreeting</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><table><thead><tr><th style="text-align:left;">JUnit 5</th> <th style="text-align:left;">JUnit 4</th> <th style="text-align:left;">说明</th></tr></thead> <tbody><tr><td style="text-align:left;">@Test</td> <td style="text-align:left;">@Test</td> <td style="text-align:left;">被注解的方法是一个测试方法。与 JUnit 4 相同。</td></tr> <tr><td style="text-align:left;">@BeforeAll</td> <td style="text-align:left;">@BeforeClass</td> <td style="text-align:left;">被注解的（静态）方法将在当前类中的所有 @Test 方法前执行一次。</td></tr> <tr><td style="text-align:left;">@BeforeEach</td> <td style="text-align:left;">@Before</td> <td style="text-align:left;">被注解的方法将在当前类中的每个 @Test 方法前执行。</td></tr> <tr><td style="text-align:left;">@AfterEach</td> <td style="text-align:left;">@After</td> <td style="text-align:left;">被注解的方法将在当前类中的每个 @Test 方法后执行。</td></tr> <tr><td style="text-align:left;">@AfterAll</td> <td style="text-align:left;">@AfterClass</td> <td style="text-align:left;">被注解的（静态）方法将在当前类中的所有 @Test 方法后执行一次。</td></tr> <tr><td style="text-align:left;">@Disabled</td> <td style="text-align:left;">@Ignore</td> <td style="text-align:left;">被注解的方法不会执行（将被跳过），但会报告为已执行。</td></tr></tbody></table> <table><thead><tr><th style="text-align:left;">断言方法</th> <th style="text-align:left;">说明</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>assertEquals(expected, actual)</code></td> <td style="text-align:left;">如果 <em>expected</em> 不等于 <em>actual</em> ，则断言失败。</td></tr> <tr><td style="text-align:left;"><code>assertFalse(booleanExpression)</code></td> <td style="text-align:left;">如果 <em>booleanExpression</em> 不是 <code>false</code> ，则断言失败。</td></tr> <tr><td style="text-align:left;"><code>assertNull(actual)</code></td> <td style="text-align:left;">如果 <em>actual</em> 不是 <code>null</code> ，则断言失败。</td></tr> <tr><td style="text-align:left;"><code>assertNotNull(actual)</code></td> <td style="text-align:left;">如果 <em>actual</em> 是 <code>null</code> ，则断言失败。</td></tr> <tr><td style="text-align:left;"><code>assertTrue(booleanExpression)</code></td> <td style="text-align:left;">如果 <em>booleanExpression</em> 不是 <code>true</code> ，则断言失败。</td></tr></tbody></table> <h2 id="logging"><a href="#logging" class="header-anchor">#</a> Logging</h2> <blockquote><p><code>spring-boot-starter-logging</code></p></blockquote> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">logging</span><span class="token punctuation">:</span>
  <span class="token key atrule">path</span><span class="token punctuation">:</span> /path/to/spring.log
  <span class="token key atrule">file</span><span class="token punctuation">:</span> spring.log
  <span class="token key atrule">level</span><span class="token punctuation">:</span>
    <span class="token key atrule">root</span><span class="token punctuation">:</span> debug
    <span class="token key atrule">xxx.xxx.xxx</span><span class="token punctuation">:</span> debug
    <span class="token key atrule">xxx.xxx.xxx</span><span class="token punctuation">:</span> debug
    <span class="token key atrule">xxx.xxx.xxx</span><span class="token punctuation">:</span> debug
  <span class="token key atrule">pattern</span><span class="token punctuation">:</span>
    <span class="token key atrule">console</span><span class="token punctuation">:</span> %d<span class="token punctuation">{</span>yyyy/MM/dd<span class="token punctuation">-</span>HH<span class="token punctuation">:</span>mm<span class="token punctuation">:</span>ss<span class="token punctuation">}</span> <span class="token punctuation">[</span>%thread<span class="token punctuation">]</span> %<span class="token punctuation">-</span>5level %logger<span class="token punctuation">-</span> %msg%n 
    <span class="token key atrule">file</span><span class="token punctuation">:</span> %d<span class="token punctuation">{</span>yyyy/MM/dd<span class="token punctuation">-</span>HH<span class="token punctuation">:</span>mm<span class="token punctuation">}</span> <span class="token punctuation">[</span>%thread<span class="token punctuation">]</span> %<span class="token punctuation">-</span>5level %logger<span class="token punctuation">-</span> %msg%n
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// ...</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Logger</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">LoggerFactory</span><span class="token punctuation">;</span>
<span class="token comment">// ...</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Xxx</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Logger</span> logger <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">Xxx</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ...</span>
    <span class="token keyword">public</span> <span class="token class-name">Xxx</span> <span class="token function">xxx</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
        <span class="token comment">// 日志级别: trace/debug/info/warn/error</span>
    	<span class="token keyword">if</span> <span class="token punctuation">(</span>logger<span class="token punctuation">.</span><span class="token function">isInfoEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// if 判断旨在性能优化</span>
            logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;xxx&quot;</span> <span class="token operator">+</span> xxx <span class="token operator">+</span> <span class="token string">&quot;xxx&quot;</span> <span class="token operator">+</span> xxx<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// or</span>
        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;xxx{}xxx{}&quot;</span><span class="token punctuation">,</span> xxx<span class="token punctuation">,</span> xxx<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre></div></div></div><div class="box"><div class="post-tags"><span class="post-tag ca-tag"><span><a class="firstca" style="color: white">程序设计</a><span><svg aria-hidden="true" focusable="false" data-prefix="fa" data-icon="caret-right" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 192 512" class="svg-inline--fa fa-caret-right fa-w-6" style="width:1rem;"><path fill="currentColor" d="M0 384.662V127.338c0-17.818 21.543-26.741 34.142-14.142l128.662 128.662c7.81 7.81 7.81 20.474 0 28.284L34.142 398.804C21.543 411.404 0 402.48 0 384.662z"></path></svg></span></span><span><a class="endcd" style="color: white">Java</a><!----></span></span><a class="ta-tag post-tag">java</a><a class="ta-tag post-tag">spring</a><a class="ta-tag post-tag">spring-boot</a><span class="da-tag post-tag">2020.08.23</span><!----></div></div><div class="box"><div id="vcomments"></div></div></div></div></div></div></main><div id="top-btn" class="btn" style="display:none;"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="arrow-up" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="svg-inline--fa fa-arrow-up fa-w-14 fa-lg"><path fill="currentColor" d="M34.9 289.5l-22.2-22.2c-9.4-9.4-9.4-24.6 0-33.9L207 39c9.4-9.4 24.6-9.4 33.9 0l194.3 194.3c9.4 9.4 9.4 24.6 0 33.9L413 289.4c-9.5 9.5-25 9.3-34.3-.4L264 168.6V456c0 13.3-10.7 24-24 24h-32c-13.3 0-24-10.7-24-24V168.6L69.2 289.1c-9.3 9.8-24.8 10-34.3.4z"></path></svg></div></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.2d05b873.js" defer></script><script src="/assets/js/9.fd2d7f08.js" defer></script><script src="/assets/js/3.5fc63a44.js" defer></script><script src="/assets/js/22.42257d5f.js" defer></script>
  </body>
</html>
